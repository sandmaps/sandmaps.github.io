function initialize(){GSI.GLOBALS.queryParams=new GSI.QueryParams({queryString:GSI.ClientMode.queryString});var t=GSI.GLOBALS.queryParams.getControlSetting(),i=GSI.GLOBALS.queryParams.getViewSetting(),e=L.Hash.parseHash(location.hash),s=GSI.GLOBALS.queryParams.getPosition(e&&e.center?e.center:CONFIG.DEFAULT.CENTER),a=GSI.GLOBALS.queryParams.getZoom(e&&e.zoom?e.zoom:CONFIG.DEFAULT.ZOOM);GSI.GLOBALS.map=GSI.map("map",{doubleClickZoom:!1,zoomsliderControl:!1,zoomControl:!1,attributionControl:!1,worldCopyJump:!1,inertiaMaxSpeed:1e3,center:s,zoom:a}),GSI.GLOBALS.map.on("moveend",function(){var t=GSI.GLOBALS.map.getCenter();(t.lat<-88||t.lat>88||t.lng<-180||t.lng>180)&&GSI.GLOBALS.map.panTo(t.wrap(),{animate:!1})}),GSI.GLOBALS.bottomRightSpacer=new GSI.Control.Spacer({position:"bottomright"}).addTo(GSI.GLOBALS.map),GSI.GLOBALS.bottomLeftSpacer=(new GSI.Control.Spacer).addTo(GSI.GLOBALS.map),CONFIG.USEACCESSCOUNTER&&new GSI.Control.AccessCounter({url:CONFIG.SERVERAPI.ACCESSCOUNTER,refreshInterval:0}).addTo(GSI.GLOBALS.map),GSI.GLOBALS.mapLayerList=new GSI.MapLayerList(GSI.GLOBALS.map);var n=new GSI.Control.BaseLayerSelector(GSI.GLOBALS.map,CONFIG.BASETILES,{defaultMap:GSI.GLOBALS.queryParams.getBaseMap(),visible:t.baseMapSelector.visible,position:"bottomleft",onChange:function(t){GSI.GLOBALS.baseLayer.setActiveIndex(t)},onGrayScaleChange:function(t){GSI.GLOBALS.baseLayer.setGrayScale(t)}}).addTo(GSI.GLOBALS.map);GSI.GLOBALS.baseLayer=n.getBaseLayer(),GSI.GLOBALS.hash=new L.Hash(GSI.GLOBALS.map,{useReplace:GSI.ClientMode.location?!1:!0}),GSI.GLOBALS.onoffObjects={},GSI.GLOBALS.onoffObjects[CONFIG.PARAMETERNAMES.CENTERCROSS]={obj:new GSI.CenterCross(GSI.GLOBALS.map,{visible:i.centerCross}),setter:"setVisible",getter:"getVisible"},GSI.GLOBALS.onoffObjects[CONFIG.PARAMETERNAMES.HIGHQUALITY]={obj:GSI.GLOBALS.baseLayer,setter:"setHighQuality",getter:"getHighQuality"},GSI.GLOBALS.cocoTileLayer=new GSI.COCOTileLayer(GSI.GLOBALS.map,CONFIG.COCOTILEURL,{subdomains:CONFIG.COCOTILESUBDOMAINS,visible:CONFIG.COCOTILEVISIBLE,onLoad:function(t){GSI.GLOBALS.layersJSON.setHasTileList(t)}}),GSI.GLOBALS.onoffObjects[CONFIG.PARAMETERNAMES.COCOTILE]={obj:GSI.GLOBALS.cocoTileLayer,setter:"setVisible",getter:"getVisible"},GSI.GLOBALS.mapMouse=new GSI.MapMouse(GSI.GLOBALS.map,{dblClickInterval:CONFIG.DBLCLICKINTERVAL,rightDblClickInterval:CONFIG.RIGHTDBLCLICKINTERVAL}),GSI.GLOBALS.onoffObjects[CONFIG.PARAMETERNAMES.CLICKMOVE]={obj:GSI.GLOBALS.mapMouse,setter:"setClickMoveVisible",getter:"getClickMoveVisible"},GSI.GLOBALS.header=new GSI.Header(GSI.GLOBALS.map,{visible:t.header.visible,message:CONFIG.TOPMESSAGE&&CONFIG.TOPMESSAGE.MESSAGE?CONFIG.TOPMESSAGE.MESSAGE:null,id:CONFIG.TOPMESSAGE&&CONFIG.TOPMESSAGE.ID?CONFIG.TOPMESSAGE.ID:null,expires:CONFIG.TOPMESSAGE&&CONFIG.TOPMESSAGE.EXPIRES?CONFIG.TOPMESSAGE.EXPIRES:null}),GSI.GLOBALS.footer=new GSI.Footer(GSI.GLOBALS.map,GSI.GLOBALS.bottomLeftSpacer,GSI.GLOBALS.bottomRightSpacer,"#map","#footerbtn","#footer","image/system/footer_up.png","image/system/footer_down.png",{visible:t.contextMenu.visible,overlap:!0}),new GSI.MapMenu(GSI.GLOBALS.map,CONFIG.MAPMENU,{visible:t.infoMenu.visible,rootEffect:CONFIG.EFFECTS.MENU.ROOT,otherEffect:CONFIG.EFFECTS.MENU.OTHER,onMenuItemClick:function(t){"additonal_layers"==t?GSI.GLOBALS.layerTreeDialog.show():"visible_layers"==t&&GSI.GLOBALS.viewListDialog.show()}}),new GSI.MapMenu(GSI.GLOBALS.map,CONFIG.FUNCMENU,{visible:t.funcMenu.visible,position:"right",rootEffect:CONFIG.EFFECTS.MENU.ROOT,otherEffect:CONFIG.EFFECTS.MENU.OTHER,getCheckState:function(t,i){return GSI.GLOBALS.onoffObjects[t]?GSI.GLOBALS.onoffObjects[t].obj[GSI.GLOBALS.onoffObjects[t].getter]():void 0},onCheckItemClick:function(t,i){GSI.GLOBALS.onoffObjects[t]&&GSI.GLOBALS.onoffObjects[t].obj[GSI.GLOBALS.onoffObjects[t].setter](i)},onMenuItemClick:function(t){var i=GSI.Utils.getScreenSize();switch(t){case"measure":if(GSI.GLOBALS.sakuzuDialog&&GSI.GLOBALS.sakuzuDialog.getVisible())return void alert("作図中は計測出来ません");GSI.GLOBALS.measureDialog||(GSI.GLOBALS.measureDialog=new GSI.MeasureDialog(GSI.GLOBALS.map,GSI.GLOBALS.mapMouse,{left:i.w-300,top:40,effect:CONFIG.EFFECTS.DIALOG})),GSI.GLOBALS.measureDialog.show();break;case"gps":GSI.GLOBALS.geoLocation||(GSI.GLOBALS.geoLocation=new GSI.GeoLocation(GSI.GLOBALS.map)),GSI.GLOBALS.geoLocation.getLocation();break;case"share_link":GSI.GLOBALS.shareDialog||(GSI.GLOBALS.shareDialog=new GSI.ShareDialog(GSI.GLOBALS.map,GSI.GLOBALS.pageStateManager,GSI.GLOBALS.layersJSON,GSI.GLOBALS.sakuzuList,{width:350,left:"center",top:45,effect:CONFIG.EFFECTS.DIALOG,resizable:!1}));var e=GSI.ShareDialog.MODE.LINK;GSI.GLOBALS.shareDialog.show(e)}}});var o=90,r=65,l=GSI.GLOBALS.queryParams.getViewListDialogVisible();l&&(o=8,r=GSI.GLOBALS.header.getHeight()+48,r=48),GSI.GLOBALS.viewListDialog=new GSI.ViewListDialog(GSI.GLOBALS.map,GSI.GLOBALS.mapLayerList,GSI.GLOBALS.cocoTileLayer,{left:o,top:r,width:320,visible:l,effect:CONFIG.EFFECTS.DIALOG,resizable:GSI.Utils.Browser.isSmartMobile?!1:"all"}),o=100,r=80,l=GSI.GLOBALS.queryParams.getLayerTreeDialogVisible(),l&&(o=8,r=48,r=GSI.GLOBALS.header.getHeight()+48),GSI.GLOBALS.layerTreeDialog=new GSI.LayerTreeDialog(GSI.GLOBALS.mapLayerList,GSI.GLOBALS.cocoTileLayer,{left:o,top:r,width:320,visible:l,effect:CONFIG.EFFECTS.DIALOG,resizable:GSI.Utils.Browser.isSmartMobile?!1:"all",currentPath:GSI.GLOBALS.queryParams.getCurrentPath()}),t.header.visible,GSI.GLOBALS.layersJSON=new GSI.LayersJSON({layers:CONFIG.layers,layersJSON:GSI.ClientMode.LayerJS,visibleLayers:GSI.GLOBALS.queryParams.getLayers()}),GSI.GLOBALS.layersJSON.on("load",function(t){GSI.GLOBALS.layerTreeDialog.setTree(t.tree);for(var i=[],e=0;e<t.visibleLayers.length;e++){var s=t.visibleLayers[e];s&&s.info&&(i.push(s.info),GSI.GLOBALS.mapLayerList.append(s.info,!0,s.hidden))}GSI.GLOBALS.cocoTileLayer.refresh()}),GSI.GLOBALS.layersJSON.load();var h=function(){var t=GSI.Utils.getScreenSize();GSI.GLOBALS.header.refresh(t),$("#map").css({top:GSI.GLOBALS.header.getHeight()+"px"}),GSI.GLOBALS.map.invalidateSize()};GSI.GLOBALS.header.on("topmessagechange",h),$(window).resize(h),h(),GSI.GLOBALS.map.setView(s,a,{reset:!0}),GSI.GLOBALS.pageStateManager=new GSI.PageStateManager(GSI.GLOBALS.map,GSI.GLOBALS.baseLayer,GSI.GLOBALS.onoffObjects,GSI.GLOBALS.mapLayerList,GSI.GLOBALS.layerTreeDialog)}var GSI={ClientMode:{},Modal:{},Draw:{},Edit:{},Control:{},Utils:{Browser:{}},GLOBALS:{},TEXT:{}},CONFIG={};CONFIG.layers=["http://maps.gsi.go.jp/layers_txt/layers1.txt","http://maps.gsi.go.jp/layers_txt/layers2.txt","http://maps.gsi.go.jp/layers_txt/layers3.txt","http://maps.gsi.go.jp/layers_txt/layers4.txt","http://maps.gsi.go.jp/layers_txt/layers_experimental.txt","http://smellman.github.io/gsimaps/layers_txt/osm_layer.txt"],CONFIG.TOPMESSAGE=null,CONFIG.DEFAULT={CENTER:[35.3622222,138.7313889],ZOOM:5},CONFIG.LAYERTYPELIST={tile:{caption:"タイル",isTile:!0,isTileImage:!0},geojson:{caption:"GeoJSON",isTile:!1},topojson:{caption:"TopoJSON",isTile:!1},geojson_tile:{caption:"GeoJSONタイル",isTile:!0},topojson_tile:{caption:"TopoJSONタイル",isTile:!0},tms:{caption:"TMS",isTile:!0,isTileImage:!0}},CONFIG.COCOTILEVISIBLE=!1,CONFIG.COCOTILEURL="http://{s}.gsi.go.jp/xyz/cocotile/{z}/{x}/{y}.csv",CONFIG.COCOTILESUBDOMAINS=["cyberjapandata-t1","cyberjapandata-t2","cyberjapandata-t3"],CONFIG.USEACCESSCOUNTER=!1,CONFIG.VISIBLELAYERTYPE=!1,CONFIG.USEIE10GRAYSCALE=!1,CONFIG.USEIE11GRAYSCALE=!0,CONFIG.FORCECORS=!0,CONFIG.SEARCHRESULTCLICKZOOM=15,CONFIG.SEARCHRESULTMAXMARKERNUM=-1,CONFIG.PAPERSIZE={A4_portrait:{w:650,h:900},A4_landscape:{w:950,h:550},A3_portrait:{w:950,h:1350},A3_landscape:{w:1400,h:900}},CONFIG.ACCESSCOUNTERRETRY=0,GSI.TEXT.ACCESSCOUNTER={},GSI.TEXT.ACCESSCOUNTER.TOOLTIP="アクセス数",GSI.TEXT.MEASURE={},GSI.TEXT.MEASURE.DIALOG_TITLE="measure",GSI.TEXT.MEASURE.DIALOG_DISTANCE_CAPTION="distance",GSI.TEXT.MEASURE.DIALOG_AREA_CAPTION="area",GSI.TEXT.MEASURE.DIALOG_OBJECT_CAPTION="feature",GSI.TEXT.SAKUZU={},GSI.TEXT.SHARE={},GSI.TEXT.SHARE.DIALOG_TITLE="share",GSI.TEXT.SHARE.DIALOG_LINK_TITLE="share",GSI.TEXT.SHARE.DIALOG_BUILTIN_TITLE="",GSI.TEXT.SHARE.DIALOG_SAVE_TITLE="",GSI.TEXT.SHARE.DIALOG_LINK_MESSAGE="share",GSI.TEXT.SHARE.DIALOG_BUILTIN_MESSAGE="",GSI.TEXT.SHARE.DIALOG_SAVE_MESSAGE="",GSI.TEXT.SHARE.DIALOG_SAVE_MESSAGE_IE8="",GSI.TEXT.SHARE.DIALOG_TEMPLATELOADERROR="大変申し訳ありません。しばらく経ってからご利用下さい",GSI.TEXT.SHARE.DIALOG_DOWNLOADBTN="上記のHTMLを保存",GSI.TEXT.SHARE.DIALOG_COPYBTN="クリップボードにコピー",GSI.TEXT.SHARE.DIALOG_NOCOPYMSG="URLをコピーしてご利用下さい",CONFIG.EFFECTS={MENU:{ROOT:{animation:"slide",option:{easing:"linear"},speed:"fast"},OTHER:{animation:"scale",option:{direction:"both",easing:"linear"},speed:"fast"}},DIALOG:{animation:"puff",option:{percent:10},speed:"fast"}},CONFIG.PARAMETERNAMES={CENTERCROSS:"centercross",COCOTILE:"cocotile",CLICKMOVE:"clickmove",HIGHQUALITY:"highquality",CONTEXTMENUOVERLAP:"contextmenuoverlap"},CONFIG.QUERYPARAMETER={},CONFIG.QUERYPARAMETER[CONFIG.PARAMETERNAMES.CENTERCROSS]={prefix:"c",settingName:"centerCross"},CONFIG.QUERYPARAMETER[CONFIG.PARAMETERNAMES.COCOTILE]={prefix:"t",settingName:"cocoTile"},CONFIG.QUERYPARAMETER[CONFIG.PARAMETERNAMES.CLICKMOVE]={prefix:"v",settingName:"clickMove"},CONFIG.HIDDENCONTROLPARAMETER={INFOMENU:"i",FUNCMENU:"f",HEADER:"h",CONTEXTMENU:"c",BASEMAPSELECTOR:"b",ALL:"all"},CONFIG.DIALOGPARAMETER={VIEWLISTDIALOG:"v",LAYERTREEDIALOG:"l"},CONFIG.GEOJSONSPECIALKEYS={_markerType:!0,_iconUrl:!0,_iconSize:!0,_iconAnchor:!0,_html:!0,_radius:!0,_className:!0,_stroke:!0,_radius:!0,_dashArray:!0,_lineCap:!0,_lineJoin:!0,_clickable:!0,_color:!0,_opacity:!0,_weight:!0,_fill:!0,_fillColor:!0,_fillOpacity:!0,_weight:!0},CONFIG.MAPMENU={title:"layers",children:[{title:"available",id:"additonal_layers",arrow:!0},{title:"displayed",id:"visible_layers",arrow:!0}]},CONFIG.FUNCMENU={title:"tools",children:[{id:"share_link",title:"share",arrow:!0},{id:"measure",title:"measure",arrow:!0},{title:"link to",arrow:!0,childrenWidth:160,children:[{title:"Mapion",href:"mapion"},{title:"いつもNAVI",href:"itsumonavi"}]},{id:"gps",title:"locate",arrow:!0,checkCondition:function(){return GSI.GeoLocation.can}}]},CONFIG.DEFAULTIMAGE={FILEICON:"image/map/file.png",TILEICON:"image/map/grid.png"},CONFIG.DBLCLICKINTERVAL=300,CONFIG.RIGHTDBLCLICKINTERVAL=500,CONFIG.BASETILES=[{id:"std",title:"standard",url:"http://{s}.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",subdomains:["cyberjapandata-t1","cyberjapandata-t2","cyberjapandata-t3"],icon:"http://cyberjapandata.gsi.go.jp/xyz/std/18/232801/103215.png",legendUrl:"http://maps.gsi.go.jp/development/ichiran.html#std",errorTileUrl:"image/map/no-data-std.png",minZoom:2},{id:"blank",title:"blank",url:"http://{s}.gsi.go.jp/xyz/blank/{z}/{x}/{y}.png",subdomains:["cyberjapandata-t1","cyberjapandata-t2","cyberjapandata-t3"],icon:"http://cyberjapandata.gsi.go.jp/xyz/blank/8/228/98.png",legendUrl:"http://maps.gsi.go.jp/development/ichiran.html#blank",maxNativeZoom:14,errorTileUrl:"image/map/no-data-blank.png",minZoom:2},{id:"english",title:"English",url:"http://{s}.gsi.go.jp/xyz/english/{z}/{x}/{y}.png",subdomains:["cyberjapandata-t1","cyberjapandata-t2","cyberjapandata-t3"],icon:"http://cyberjapandata.gsi.go.jp/xyz/english/7/113/50.png",legendUrl:"http://maps.gsi.go.jp/development/ichiran.html#english",maxNativeZoom:11,errorTileUrl:"image/map/no-data-english.png",minZoom:2},{id:"ort",title:"photo",url:"http://{s}.gsi.go.jp/xyz/ort/{z}/{x}/{y}.jpg",subdomains:["cyberjapandata-t1","cyberjapandata-t2","cyberjapandata-t3"],icon:"http://cyberjapandata.gsi.go.jp/xyz/ort/16/58274/25716.jpg",legendUrl:"http://maps.gsi.go.jp/development/ichiran.html#ort",errorTileUrl:"image/map/no-data-ort.png",minZoom:2},{id:"none",title:"none",url:"image/map/none.png",icon:"image/map/none.png"}],CONFIG.SERVERAPI={},CONFIG.SERVERAPI.HOSTNAME="portal.cyberjapan.jp",CONFIG.SERVERAPI.BASE="http://portal.cyberjapan.jp/",CONFIG.SERVERAPI.GETJSONP=CONFIG.SERVERAPI.BASE+"site/mapuse4/kml2jsonp.php",CONFIG.SERVERAPI.ACCESSCOUNTER="./cgi-bin/CounterJson.php?id=001",CONFIG.SERVERAPI.INTERFACE="http://portal.cyberjapan.jp/GsiJsLibrary/interface.php",CONFIG.SERVERAPI.GETADDR="http://portal.cyberjapan.jp/GsiJsLibrary/LonLatToLv01.php",CONFIG.SERVERAPI.GETELEVATION="http://cyberjapandata.gsi.go.jp/cgi-bin/getelevation.php",CONFIG.SERVERAPI.SEARCH="http://geocode.csis.u-tokyo.ac.jp/cgi-bin/simple_geocode.cgi",CONFIG.SERVERAPI.SEARCH_SHISETU="http://portal.cyberjapan.jp/GsiJsLibrary/shisetsu.php",CONFIG.SERVERAPI.SEARCH_CHIMEI="http://portal.cyberjapan.jp/GsiJsLibrary/chimei.php",CONFIG.SERVERAPI.MGRSXY="",jQuery.extend({stringify:function(t){var i=typeof t;if("object"!=i||null===t)return"string"==i&&(t='"'+t+'"'),String(t);var e=[],s=t&&t.constructor==Array;for(var a in t){var n=t[a];i=typeof n,t.hasOwnProperty(a)&&("string"==i?n='"'+n+'"':"object"==i&&null!==n&&(n=jQuery.stringify(n)),e.push((s?"":'"'+a+'":')+String(n)))}return(s?"[":"{")+String(e)+(s?"]":"}")}});try{window.console=window.console||{log:function(){}}}catch(e){}try{window.JSON||(window.JSON={parse:function(t){return $.parseJSON(t)},stringify:function(t){return $.stringify(t)}})}catch(e){}try{!function(t){t.map||(t.map=function(t){for(var i=[],e=0;e<this.length;e++)void 0!==this[e]&&(i[e]=t(this[e]));return i}),t.filter||(t.filter=function(t){for(var i=[],e=0;e<this.length;e++)void 0!==this[e]&&t(this[e])&&(i[e]=this[e]);return i})}(Array.prototype)}catch(e){}if(L.DomUtil.setOpacity=function(t,i){$(t).css({opacity:i})},void 0===window.ActiveXObject||window.XDomainRequest||(jQuery.ajaxSettings.xhr=function(){try{return new window.XMLHttpRequest}catch(t){}}),Proj4js.defs["EPSG:3097"]="+proj=utm +zone=51 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:3098"]="+proj=utm +zone=52 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:3099"]="+proj=utm +zone=53 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:3100"]="+proj=utm +zone=54 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:3101"]="+proj=utm +zone=55 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["SR-ORG:1235"]="+proj=utm +zone=56 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:4301"]="+proj=longlat +ellps=bessel +towgs84=-146.336,506.832,680.254,0,0,0,0 +no_defs",$(document).ready(initialize),GSI.Map=L.Map.extend({_initPanes:function(){L.Map.prototype._initPanes.call(this),this._panes.gsiObjectsPane=this._createPane("gsi-objects-pane")},_limitCenter:function(t,i,e){if(!e)return t;var s=this.project(t,i),a=this.getSize().divideBy(2),n=new L.Bounds(s.subtract(a),s.add(a)),o=this._getBoundsOffset(n,e,i),r=this.unproject(s.add(o),i);return r},_limitOffset:function(t,i){if(!i)return t;var e=this.getPixelBounds(),s=new L.Bounds(e.min.add(t),e.max.add(t));return t.add(this._getBoundsOffset(s,i))}}),GSI.map=function(t,i){return new GSI.Map(t,i)},L.LayerGroup.prototype.setMarkerZIndex=function(t){this._setMarkerZIndex(this,t)},L.LayerGroup.prototype._setMarkerZIndex=function(t,i){if(t.setZIndexOffset)t.setZIndexOffset(i);else if(t.getLayers)for(var e=t.getLayers(),s=0;s<e.length;s++)this._setMarkerZIndex(e[s],i)},L.Popup.prototype._updateLayout=function(){var t=this._contentNode,i=t.style,e=$(t).find("table"),s=null;e.length>0&&(s=e.attr("width"),s||(s=e[0].style.width)),i.width="",s||(i.whiteSpace="nowrap");var a=t.offsetWidth;a=Math.min(a,this.options.maxWidth),a=Math.max(a,this.options.minWidth),i.width=a+1+"px",i.whiteSpace="",i.height="";var n=t.offsetHeight,o=this.options.maxHeight,r="leaflet-popup-scrolled";o&&n>o?(i.height=o+"px",L.DomUtil.addClass(t,r)):L.DomUtil.removeClass(t,r),this._containerWidth=this._container.offsetWidth},L.Path.prototype.onRemove=function(t){t._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,this._container=null,this._stroke=null,this._fill=null,t.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},GSI.PageStateManager=L.Class.extend({initialize:function(t,i,e,s,a){this._map=t,this._onOffObjects=e,this._baseLayer=i,this._mapLayerList=s,this._layerTreeDialog=a},getPositionQueryString:function(){var t=this._map.getCenter().wrap(),i=this._map.getZoom();return"ll="+Math.round(1e6*t.lat)/1e6+","+Math.round(1e6*t.lng)/1e6+"&z="+i},getCurrentPathQueryString:function(){var t=this._layerTreeDialog.getCurrentPath();return t&&""!=t?"cd="+encodeURIComponent(t):""},getBaseLayerQueryString:function(){return"base="+encodeURIComponent(this._baseLayer.getActiveId())},getLayersQueryString:function(t){t||(t={});var i="",e=[];if(!t.noTile)for(var s=this._mapLayerList.getTileList(),a=0;a<s.length;a++)e.push(s[a]);for(var a=e.length-1;a>=0;a--){var n=e[a]._visibleInfo&&e[a]._visibleInfo.opacity?e[a]._visibleInfo.opacity:1;i+=(""!=i?"|":"")+e[a].id+(1!=n?","+n:"")}var o=[];if(!t.noList)for(var r=this._mapLayerList.getList(),a=0;a<r.length;a++)o.push(r[a]);for(var a=o.length-1;a>=0;a--){var n=o[a]._visibleInfo&&o[a]._visibleInfo.opacity?o[a]._visibleInfo.opacity:1;i+=(""!=i?"|":"")+o[a].id+(1!=n?","+n:"")}return""!=i?"ls="+encodeURIComponent(i):""},getViewSettingVisible:function(t){var i=this._onOffObjects[t];return i?i.obj[i.getter]():!1},getQueryParams:function(t){t||(t={});var i={};t.hcList||(t.hcList=[]);var e=t.hcList.join("");""!=e&&(i.hc=e),t.vsInfo||(t.vsInfo={}),t.vsInfo.skips||(t.vsInfo.skips={}),t.vsInfo.visibles||(t.vsInfo.visibles={});var s=t.vsInfo,a="";for(var n in CONFIG.QUERYPARAMETER){var o=this._onOffObjects[n],r=CONFIG.QUERYPARAMETER[n];r&&o&&!s.skips[n]&&(a+=1==s.visibles[n]||0==s.visibles[n]?r.prefix+(s.visibles[n]?"1":"0"):o.obj[o.getter]()?r.prefix+"1":r.prefix+"0")}""!=a&&(i.vs=a);var l="";t.visibleDialogs||(t.visibleDialogs={});for(var n in t.visibleDialogs)t.visibleDialogs[n]&&(l+=n);return""!=l&&(i.d=l),i},getTileViewSetting:function(t){t||(t={});var i="",e=[];if(!t.noTile)for(var s=this._mapLayerList.getTileList(),a=0;a<s.length;a++)e.push(s[a]);for(var a=e.length-1;a>=0;a--)i+=e[a]._visibleInfo&&e[a]._visibleInfo._isHidden?"0":"1";var n=[];if(!t.noList)for(var o=this._mapLayerList.getList(),a=0;a<o.length;a++)n.push(o[a]);for(var a=n.length-1;a>=0;a--)i+=n[a]._visibleInfo&&n[a]._visibleInfo._isHidden?"0":"1";return""!=i?"disp="+i:""}}),GSI.QueryParams=L.Class.extend({_controlSetting:{infoMenu:{visible:!0},funcMenu:{visible:!0},header:{visible:!0},contextMenu:{visible:!0},baseMapSelector:{visible:!0}},_viewSetting:{centerCross:!1},_layers:[],_currentPath:null,_viewListDialogVisible:!1,_layerTreeDialogVisible:!1,initialize:function(t){this.params=this._parse(t&&t.queryString?t.queryString:window.location.search);try{this._initPosition()}catch(i){}try{this._initBaseMap()}catch(i){}try{this._initControlSetting()}catch(i){}try{this._initViewSetting()}catch(i){}try{this._initLayerList()}catch(i){}try{this._initDialogSettings()}catch(i){}try{this._initCurrentPath()}catch(i){}},getPosition:function(t){return this._position?this._position:t},getZoom:function(t){return this._zoom?this._zoom:t},getBaseMap:function(){return this._baseMap},getLayers:function(){return this._layers},getViewListDialogVisible:function(){return this._viewListDialogVisible},getLayerTreeDialogVisible:function(){return this._layerTreeDialogVisible},getCurrentPath:function(){return this._currentPath},getControlSetting:function(){return this._controlSetting},getViewSetting:function(){return this._viewSetting},_initPosition:function(){if(this.params.ll){var t=this.params.ll.split(",");2==t.length&&(t[0].match(/^-?[0-9]+\.[0-9]+$/)||t[0].match(/^-?[0-9]+$/))&&(t[1].match(/^-?[0-9]+\.[0-9]+$/)||t[1].match(/^-?[0-9]+$/))&&(this._position=[parseFloat(t[0]),parseFloat(t[1])])}this.params.z&&this.params.z.match(/^[0-9]+$/)&&(this._zoom=parseInt(this.params.z)),this._zoom&&(this._zoom<1||this._zoom>18)&&(this._zoom=null)},_initBaseMap:function(){this.params.base&&(this._baseMap=this.params.base)},_initLayerList:function(){if(this._layers=[],this.params.ls)for(var t=this.params.disp,i=this.params.ls.split("|"),e=0;e<i.length;e++)if(""!=$.trim(i[e])){var s=i[e].split(","),a=!1;a=t&&t.length>e&&"0"==t.charAt(e)?!0:!1;var n={id:s[0],opacity:1,hidden:a};if(s.length>=2){var o=s[1];isNaN(o)||(o=parseFloat(o),o>=0&&1>=o&&(n.opacity=o))}this._layers.push(n)}},_initControlSetting:function(){if(this.params.hc){var t=this.params.hc;if(t.toLowerCase()==CONFIG.HIDDENCONTROLPARAMETER.ALL)this._controlSetting={infoMenu:{visible:!1},funcMenu:{visible:!1},header:{visible:!1},contextMenu:{visible:!1},baseMapSelector:{visible:!1}};else for(var i=0;i<t.length;i++)switch(t.charAt(i).toLowerCase()){case CONFIG.HIDDENCONTROLPARAMETER.INFOMENU:this._controlSetting.infoMenu.visible=!1;break;case CONFIG.HIDDENCONTROLPARAMETER.FUNCMENU:this._controlSetting.funcMenu.visible=!1;break;case CONFIG.HIDDENCONTROLPARAMETER.HEADER:this._controlSetting.header.visible=!1;break;case CONFIG.HIDDENCONTROLPARAMETER.CONTEXTMENU:this._controlSetting.contextMenu.visible=!1;break;case CONFIG.HIDDENCONTROLPARAMETER.BASEMAPSELECTOR:this._controlSetting.baseMapSelector.visible=!1}}},_initViewSetting:function(){if(this.params.vs)for(var t=this.params.vs,i=0;i<t.length&&t.length-1!=i;i+=2){var e=t.charAt(i),s=t.charAt(i+1);for(var a in CONFIG.QUERYPARAMETER)if(CONFIG.QUERYPARAMETER[a].prefix==e){this._viewSetting[CONFIG.QUERYPARAMETER[a].settingName]="1"==s;break}}},_initDialogSettings:function(){if(this.params.d)for(var t=this.params.d,i=0;i<t.length;i++){var e=t.charAt(i);switch(e){case CONFIG.DIALOGPARAMETER.VIEWLISTDIALOG:this._viewListDialogVisible=!0;break;case CONFIG.DIALOGPARAMETER.LAYERTREEDIALOG:this._layerTreeDialogVisible=!0}}},_initCurrentPath:function(){if(this.params.cd){var t=this.params.cd;t&&""!=t&&(this._currentPath=t)}},_parse:function(t,i){var e={};if(1<t.length)for(var s="?"==t.charAt(0)?t.substring(1):t,a=s.split("&"),n=0;n<a.length;n++){var o=a[n].split("="),r=decodeURIComponent(o[0]),l=decodeURIComponent(o[1]);e[r]=l}return e}}),GSI.Modal.instance=null,GSI.Modal.instanceList=[],GSI.Modal.blind=null,GSI.Modal.zIndexOffset=5e4,GSI.Modal.BaseClass=L.Class.extend({includes:L.Mixin.Events,options:{closeBtnVisible:!0,blindClose:!0},container:null,initialize:function(t){t=L.setOptions(this,t)},show:function(t){GSI.Modal.instanceList.push(this),t=L.setOptions(this,t),this.createBlind(),this.container?this.contentFrame.empty():(this.container=this.createContainer(),$(document.body).append(this.container)),t&&t.width?this.contentFrame.css({width:t.width+"px"}):this.contentFrame.css({width:"auto"}),this.getContent&&this.contentFrame.append(this.getContent()),GSI.Modal.blind.is(":visible")||GSI.Modal.blind.show("fade",{direction:"both",easing:"linear"},"fast"),this.container.show("fade",{direction:"both",easing:"linear"},"fast"),this._onWindowResize||(this._onWindowResize=L.bind(this.onWindowResize,this),$(window).on("resize",this._onWindowResize))},onWindowResize:function(){this.adjustWindow()},adjustWindow:function(){var t=GSI.Utils.getScreenSize(),i=this.container.is(":visible");i||this.container.css({visibility:"hidden"}).show(),this.contentFrame.css({"max-width":t.w-50+"px","max-height":t.h-50+"px"});var e=this.container.outerWidth(!0),s=this.container.outerHeight(!0);this.container.css({left:Math.floor(t.w/2-e/2)+"px",top:Math.floor(t.h/2-s/2)+"px"}),i||this.container.hide().css({visibility:"visible"})},createContainer:function(){var t=$("<div>").hide().addClass(this.options.className?this.options.className:"gsi_modal_base").css({"z-index":GSI.Modal.zIndexOffset+1+GSI.Modal.instanceList.length,position:"absolute"});return this.contentFrame=$("<div>").addClass("gsi_modal_base_content"),t.append(this.contentFrame),this.options.closeBtnVisible&&(this.closeButton=$("<a>").addClass("gsi_modal_base_closebtn").attr({href:"javascript:void(0);"}).html("×").click(L.bind(function(){this.hide()},this)),t.append(this.closeButton)),t},hide:function(t){this._onWindowResize&&($(window).off("resize",this._onWindowResize),delete this._onWindowResize,this._onWindowResize=null);for(var i=0;i<GSI.Modal.instanceList.length;i++)if(GSI.Modal.instanceList[i]==this){GSI.Modal.instanceList.splice(i,1);break}this.container&&this.container.remove(),this.closeButton&&this.closeButton.remove(),delete this.closeButton,delete this.container,this.closeButton=null,this.container=null,GSI.Modal.instanceList.length<=0&&this.removeBlind()},getBlindClose:function(){return this.options.blindClose},createBlind:function(){GSI.Modal.blind||(GSI.Modal.blind=$("<div>").css({opacity:.3,background:"#666",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","z-index":GSI.Modal.zIndexOffset,display:"none",cursor:"pointer"}).click(function(){}),$(document.body).append(GSI.Modal.blind))},removeBlind:function(){GSI.Modal.blind&&GSI.Modal.blind.remove(),delete GSI.Modal.blind,GSI.Modal.blind=null}}),GSI.Modal.Dialog=GSI.Modal.BaseClass.extend({options:{positiveButtonText:"決定",nagativeButtonText:"中止",blindClose:!1,closeBtnVisible:!1,className:"gsi_modal_dialog"},show:function(t){GSI.Modal.BaseClass.prototype.show.call(this,t)},getContent:function(){return this.dialogFrame=$("<div>").addClass("gsi_modal_dialog_frame"),this.dialogContent=$("<div>").addClass("gsi_modal_dialog_content"),this.buttonFrame=$("<div>").addClass("gsi_modal_dialog_btn_frame"),this.positiveButton=$("<a>").attr({href:"javascript:void(0);"}).html(this.options.positiveButtonText).click(L.bind(this.onPositiveButtonClick,this)),this.negativeButton=$("<a>").attr({href:"javascript:void(0);"}).html(this.options.nagativeButtonText).click(L.bind(this.onNegativeButtonClick,this)),this.buttonFrame.append(this.positiveButton).append(this.negativeButton),this.dialogFrame.append(this.dialogContent),this.dialogFrame.append(this.buttonFrame),this.dialogFrame},onPositiveButtonClick:function(){this.hide(),this.fire("positive")},onNegativeButtonClick:function(){this.hide(),this.fire("negative")}}),GSI.Modal.FileSelectDialog=GSI.Modal.Dialog.extend({options:{title:"ファイルを選択して下さい"},getContent:function(){var t=$("<div>"),i=($("<div>").addClass("gsi_modal_fileselect_dlg_title").html(this.options.title),null);i=$("<div>").addClass("gsi_modal_fileselect_dlg_title"),t.append(i),i.append($("<span>").addClass("title").html(this.options.title)),GSI.Utils.hasFileAPI&&(this.switcher=new GSI.OnOffSwitch,this.switcher.on("change",L.bind(function(){this.switcher.checked()?this.fileFrame.is(":visible")||this.sourceFrame.fadeOut("fast",L.bind(function(){this.fileFrame.fadeIn("fast")},this)):this.sourceFrame.is(":visible")||this.fileFrame.fadeOut("fast",L.bind(function(){this.sourceFrame.fadeIn("fast")},this))},this)),i.append(this.switcher.getElement().css({"float":"right"})),this.fileFrame=$("<div>").addClass("gsi_modal_fileselect_dlg_inputframe"),this.fileInput=$("<input>").attr({type:"file"}),this.fileMessage=$("<div>").addClass("message").html("ファイルを選択後「<strong>決定</strong>」ボタンをクリックして下さい"),this.fileFrame.append(this.fileMessage),this.fileFrame.append(this.fileInput),t.append(this.fileFrame)),this.sourceFrame=$("<div>").addClass("gsi_modal_fileselect_dlg_inputframe").hide(),this.sourceTextArea=$("<textarea>"),GSI.Utils.hasFileAPI||this.sourceFrame.show(),this.sourceMessage=$("<div>").addClass("message").html("ソースを入力後「<strong>決定</strong>」ボタンをクリックして下さい"),this.sourceFrame.append(this.sourceMessage),this.sourceFrame.append(this.sourceTextArea),t.append(this.sourceFrame);var e=GSI.Modal.Dialog.prototype.getContent.call(this);return this.dialogContent.append(t),e},_onFileLoad:function(){this.hide(),this.fire("positive",{text:this.reader.result})},_onLoadErrorExit:function(){alert("ファイルの読込に失敗しました")},onPositiveButtonClick:function(){var t="";if(this.fileFrame&&this.fileFrame.is(":visible")){var i=this.fileInput.attr("files");i||(i=this.fileInput.prop("files")),i&&i.length>0?(this.reader=new FileReader,this.reader.onload=L.bind(this._onFileLoad,this),this.reader.onerror=L.bind(this._onLoadErrorExit,this),this.reader.readAsText(i[0])):alert("ファイルが選択されていません")}else t=this.sourceTextArea.val(),""!=$.trim(t)?(this.hide(),this.fire("positive",{text:t})):alert("ソースが入力されていません")},onNegativeButtonClick:function(){this.hide(),this.fire("negative")}}),GSI.MapMouse=L.Class.extend({clickMoveVisible:!0,clickMoveEnable:!0,rightClickTime:null,options:{dblClickInterval:500,rightDblClickInterval:500},initialize:function(t,i){this.map=t,t.on("contextmenu",function(){}),this.setClickMoveVisible(this.clickMoveVisible,!0),t.on("mousedown",L.bind(this.onMouseDown,this)),t.on("zoomend",L.bind(this.onZoomEnd,this)),t.on("dblclick",L.bind(this.onMapDblClick,this)),L.setOptions(this,i)},onZoomEnd:function(t){this.map.getZoom()>=18?this.map.doubleClickZoom.disable():this.map.doubleClickZoom.enable()},_rightDblClickZoomOut:function(t){var i=this.map.getZoom();i>=1&&this.map.setZoomAround(t,i-1)},onMouseDown:function(t){if(3==t.originalEvent.which)if(null==this.rightClickTime){var i=new Date;this.rightClickTime=i.getTime(),this._startRightClickTimer(t.latlng)}else{var i=new Date;i<this.rightClickTime+this.options.rightDblClickInterval?(this._rightDblClickZoomOut(t.latlng),this.rightClickTime=null):this.rightClickTime=null}else this.rightClickTime=null},onMapClick:function(t){this.clickMoveVisible&&this._startClickTimer(t.latlng)},_move:function(t){this.map.panTo(t)},_clearClickTimer:function(){this._clickTimerId&&(clearTimeout(this._clickTimerId),this._clickTimerId=null)},_startClickTimer:function(t){this._clearClickTimer(),this._clickTimerId=setTimeout(L.bind(this._move,this,t),this.options.dblClickInterval)},onMapDblClick:function(t){if(this._clickTimerId){this._clearClickTimer();var i=this.map.getZoom();18>i&&this.map.setZoomAround(t.latlng,i+1)}},setClickMoveVisible:function(t,i){this.clickMoveVisible=t,this.refresh()},getClickMoveVisible:function(){return this.clickMoveVisible},refresh:function(){this.clickMoveVisible&&this.clickMoveEnable?this._onMapClick||(this._onMapClick=L.bind(this.onMapClick,this),this.map.on("click",this._onMapClick)):this._onMapClick&&(this.map.off("click",this._onMapClick),this._onMapClick=null)},getClickMoveVisible:function(t){return this.clickMoveVisible},setClickMoveEnable:function(t){this.clickMoveEnable=t,this.refresh()},_startRightClickTimer:function(t){this._clearRightClickTimer(),this._RightClickTimerId=setTimeout(L.bind(this._zoom_Out,this,t),this.options.dblClickInterval)},_clearRightClickTimer:function(){this._RightClickTimerId&&(clearTimeout(this._RightClickTimerId),this._RightClickTimerId=null)},_zoom_Out:function(t){if(null!=this.rightClickTime){this._move(t);var i=GSI.GLOBALS.footer.isVisible();0==i&&GSI.GLOBALS.footer.onBtnClick()}this.rightClickTime=null}}),GSI.GeoLocation=L.Class.extend({includes:L.Mixin.Events,options:{},initialize:function(t){this.map=t},getLocation:function(){return GSI.GeoLocation.can?this.watchId?!1:(this.watchCounter=0,this.watchId=navigator.geolocation.watchPosition(L.bind(function(t){if(t.coords.accuracy<100||this.watchCounter>=0){var i=t.coords.latitude,e=t.coords.longitude;this.map.setView([i,e],CONFIG.SEARCHRESULTCLICKZOOM),navigator.geolocation.clearWatch(this.watchId),this.watchId=null}this.watchCounter++},this),L.bind(this.locationError,this),{enableHighAccuracy:!0,timeout:6e4,maximumAge:0}),!0):!1}}),GSI.GeoLocation.can=navigator.geolocation&&"function"==typeof navigator.geolocation.getCurrentPosition?!0:!1,GSI.Header=L.Class.extend({includes:L.Mixin.Events,options:{visible:!0},topMessageVisible:!1,header:null,initialize:function(t,i){if(i=L.setOptions(this,i),i.visible)if(this.header=$("#header"),this.logoImage=$("#logoimage"),this.topMessage=$("#topmessage"),this._isVisibleStart()){this.topMessage.empty().append($("<div>").addClass("message").html(i.message));var e=$("<a>").addClass("closebtn").attr({href:"javascript:void(0);"}).html("×");this.topMessage.append(e),e.click(L.bind(this.onCloseClick,this)),this.topMessageVisible=!0}else $("#topmessage").hide(),this.header.addClass("border_bottom"),this.topMessageVisible=!1;else $("#header").hide(),$("#topmessage").hide(),this.topMessageVisible=!1;this.map=t;
},_isVisibleStart:function(){if(this.options.message&&""!=this.options.message){if(this.options.expires>0)try{var t=new GSI.Utils.Cookie,i=t.get("topmessage_hidden"),e=t.get("topmessage_id");if("1"==i&&e==this.options.id)return!1}catch(s){}else try{t.remove("topmessage_hidden"),t.remove("topmessage_id")}catch(s){}return!0}return!1},hideTopMessage:function(){this.topMessage.hide(),this.header.addClass("border_bottom"),this.topMessageVisible=!1;try{if(this.options.expires>0){var t=new GSI.Utils.Cookie;t.set("topmessage_hidden","1",{expires:this.options.expires}),this.options.id?t.set("topmessage_id",this.options.id,{expires:this.options.expires}):t.remove("topmessage_id")}else t.remove("topmessage_hidden"),t.remove("topmessage_id")}catch(i){}},onCloseClick:function(){this.topMessage.animate({height:"hide"},{duration:80,easing:"linear",complete:L.bind(function(){this.hideTopMessage(),this.fire("topmessagechange")},this),step:L.bind(function(){this.fire("topmessagechange")},this)})},getHeight:function(){return this.options.visible?this.header.outerHeight(!0)+(this.topMessageVisible?this.topMessage.outerHeight(!0):0):0},refresh:function(t){if(this.options.visible){var i="logo_l",e="logo_s",s="image/logo_s.png";t.w>=600&&(i="logo_s",e="logo_l",s="image/logo_l.png"),this.header.removeClass(i),this.header.addClass(e),this.currentImageUrl!=s&&(this.logoImage.attr({src:s}),this.currentImageUrl=s)}}}),GSI.Footer=L.Class.extend({options:{visible:!0},overlap:!1,initialize:function(t,i,e,s,a,n,o,r,l){return L.setOptions(this,l),l.visible?(this.overlap=l.overlap,this.map=t,this.bottomLeftSpacer=i,this.bottomRightSpacer=e,this.mapSelector=s,this.btnSelector=a,this.footerSelector=n,this.upImage=o,this.downImage=r,$(this.btnSelector).click(L.bind(this.onBtnClick,this)),this._onMapMove=L.bind(this.onMapMove,this),this._onMapMoveStart=L.bind(this.onMapMoveStart,this),this._onMapMoveEnd=L.bind(this.onMapMoveEnd,this),$(window).resize(L.bind(this.onWindowResize,this)),this.onWindowResize(),void $(this.btnSelector).css({visibility:"visible"}).show()):($(a).hide(),void $(n).hide())},isVisible:function(){return $(this.footerSelector).is(":visible")},onWindowResize:function(){this.refreshSize()},setOverlap:function(t){this.overlap=t,this.refreshSize()},getOverlap:function(){return this.overlap},refreshSize:function(){var t=GSI.Utils.getScreenSize();t.w<t.h?$(".mini_comment").addClass("landscape"):$(".mini_comment").removeClass("landscape");var i=$(this.btnSelector),e=$(this.footerSelector).is(":visible")?$(this.footerSelector).outerHeight(!0):0;i.css({left:Math.round(t.w/2-i.outerWidth(!0)/2)+"px",bottom:e+"px"})},onBtnClick:function(){var t=$(this.footerSelector).outerHeight(!0);$(this.footerSelector).is(":visible")?($(this.btnSelector).find("img").attr({src:this.upImage}),this.overlap?($(this.mapSelector).stop().css({bottom:"0px"}),$(this.btnSelector).stop().animate({bottom:"0px"},300),this.map.invalidateSize()):($(this.mapSelector).stop().animate({bottom:"0px"},300),$(this.btnSelector).stop().animate({bottom:"0px"},300)),$(this.footerSelector).stop().animate({bottom:-t+"px"},300,L.bind(function(){$("#footer").hide(),this.overlap||this.map.invalidateSize(),this.overlap&&(this.bottomLeftSpacer.setHeight(0),this.bottomRightSpacer.setHeight(0))},this)),this.map.off("movestart",this._onMapMoveStart),this.map.off("moveend",this._onMapMoveEnd)):(this.onMapMove(),this.onMapMoveEnd(),$(this.btnSelector).find("img").attr({src:this.downImage}),this.overlap?($(this.mapSelector).stop().css({bottom:"0px"}),$(this.btnSelector).stop().animate({bottom:t+"px"},300),this.map.invalidateSize()):($(this.mapSelector).stop().animate({bottom:t+"px"},300),$(this.btnSelector).stop().animate({bottom:t+"px"},300)),$(this.footerSelector).css({bottom:-t+"px"}).show().stop().animate({bottom:"0px"},300,L.bind(function(){this.overlap||this.map.invalidateSize(),this.overlap&&(this.bottomLeftSpacer.setHeight(t),this.bottomRightSpacer.setHeight(t))},this)),this.map.on("movestart",this._onMapMoveStart),this.map.on("moveend",this._onMapMoveEnd))},onMapMoveStart:function(){this.clear()},onMapMove:function(){var t=this.map.getCenter().wrap(),i=GSI.Utils.latLngToDMS(t);$("#latlng_60").html((t.lat<0?"-":"")+i.lat.d+"度"+i.lat.m+"分"+(Math.round(100*i.lat.s)/100).toFixed(2)+"秒&nbsp;"+(t.lng<0?"-":"")+i.lng.d+"度"+i.lng.m+"分"+(Math.round(100*i.lng.s)/100).toFixed(2)+"秒"),$("#latlng_10").html((Math.round(1e6*t.lat)/1e6).toFixed(6)+","+(Math.round(1e6*t.lng)/1e6).toFixed(6));var e=GSI.UTM.Utils.latlng2PointName(t.lat,t.lng);$("#utm_point").html(""==e?"---":e),$("#current_zoom").html(this.map.getZoom()),this.refreshSize()},onMapMoveEnd:function(){this.onMapMove();var t=this.map.getCenter().wrap();this.refresh(t.lng,t.lat)},clear:function(){if($("#address").empty(),$("#address").append("---"),$("#elevation").empty(),$("#elevation").append("---"),this.refreshSize(),this.ajaxAddress){try{this.ajaxAddress.abort()}catch(t){}this.ajaxAddress=null}if(this.ajaxElevation){try{this.ajaxElevation.abort()}catch(t){}this.ajaxElevation=null}},refresh:function(t,i){this.clear(),this.refreshTimerId=setTimeout(L.Util.bind(this.execRefresh,this,t,i),800)},getAddressRusult:function(json){var json=json.result;if(json){var address="";if(-1!=json.indexOf('{"result":[')){var result=json,obj,html="";obj=eval("obj="+result);var addObj=obj.result[0];addObj&&(addObj.prefNm&&(address+=addObj.prefNm),addObj.conNm&&(address+=addObj.conNm),addObj.muniNm&&(address+=addObj.muniNm),addObj.lv01Nm&&(address+=addObj.lv01Nm))}$("#address").empty(),$("#address").append(address?address:"---"),this.refreshSize()}},getElevationRusult:function(t){var i=t.elevation+"m（"+t.hsrc+"）";$("#elevation").html(i),this.refreshSize()},execRefresh:function(t,i){var e=CONFIG.SERVERAPI.GETADDR;e+="?longitude="+t+"&latitude="+i;var s={};s.request=e,this.ajaxAddress=$.ajax({type:"GET",url:CONFIG.SERVERAPI.INTERFACE,data:s,dataType:"jsonp",timeout:3e4,success:L.Util.bind(this.getAddressRusult,this),error:function(){}}),this.ajaxElevation=$.ajax({type:"GET",dataType:"jsonp",url:CONFIG.SERVERAPI.GETELEVATION+"?lon="+t+"&lat="+i,success:L.Util.bind(this.getElevationRusult,this)})}}),GSI.MapMenuList=[],GSI.MapMenu=L.Class.extend({options:{position:"left",zIndex:15e3,visible:!0,getCheckState:function(t){return t}},idCounter:0,rootItem:{},initialize:function(t,i,e){e=L.setOptions(this,e),e.visible&&(this.map=t,GSI.MapMenuList.push(this),this.initializeTree(i),t.on("mousedown",L.bind(function(){this.hide()},this)),$(t.getContainer()).on("touchstart",L.bind(function(){this.hide()},this)),$(window).resize(L.bind(function(){this.hide(!0)},this)))},initializeTree:function(t){var i=$("<a>").attr({href:"javascript:void(0);"}).html(t.title).addClass("menu_btn").click(L.bind(this.onItemClick,this)),e=new GSI.Control.Button(i[0],{position:"top"+this.options.position});e.addTo(this.map),this.rootItem={elem:i,children:[],depth:0},i.data({data:this.rootItem}),this.initializeTreeItems(this.rootItem,t,1)},initializeTreeItems:function(t,i,e){if(i.children&&i.children.length>0){var s=$("<ul>").addClass("menu_item_frame").css({"z-index":this.options.zIndex+e}).hide();i.childrenWidth&&s.css({width:i.childrenWidth+"px"});for(var a=0;a<i.children.length;a++){var n=i.children[a];if(n&&(!n.checkCondition||n.checkCondition())){var o=$("<li>"),r={};if(n.typeA&&"check"==n.typeA){var l=($("<div>"),this.options.getCheckState(n.id,n.defaultCheck)),h=new GSI.OnOffSwitch({className:"onoff",checked:l,title:n.title});o.append($("<dl>").append($("<dt>").html('<label for="'+h.getId()+'">'+n.title+"</label>").css({"line-height":"24px",margin:"0px",clear:"left","float":"left",width:"73%"})).append($("<dd>").append(h.getElement()).css({margin:"0px","margin-left":"73%"})).css({margin:"0px"})).css({"padding-top":"10px","padding-bottom":"10px"}),r={id:n.id},h.getCheckBox().data({data:r}),h.on("change",L.bind(this.onCheckBoxClick,this,h.getCheckBox()))}else{var d=$("<a>").attr({href:"javascript:void(0);"}).html(n.title).click(L.bind(this.onItemClick,this));n.arrow?(d.addClass("arrow"),d.addClass(this.options.position)):n.right&&d.addClass("right"),r={elem:d,id:n.id,children:[],depth:e,parent:t,href:n.href},d.data({data:r}),t.children.push(r),o.append(d)}s.append(o),t.childrenFrame=s,this.initializeTreeItems(r,n,e+1)}}$(document.body).append(s)}},hideChildren:function(t,i){if(t.childrenFrame&&(i?t.childrenFrame.hide():t.depth<=0?this.showChildFrame(t.childrenFrame,!0,{direction:"up"},!0):this.showChildFrame(t.childrenFrame,!1,{origin:["top","right"]},!0)),t.children)for(var e=0;e<t.children.length;e++)this.hideChildren(t.children[e],i)},_fireOnShow:function(){for(var t=0;t<GSI.MapMenuList.length;t++)this!=GSI.MapMenuList[t]&&GSI.MapMenuList[t].hide()},showChildFrame:function(t,i,e,s){var a=i?this.options.rootEffect:this.options.otherEffect;if(a){if(a.option||(a.option={}),e)for(var n in e)a.option[n]=e[n];s?t.hide(a.animation,a.option,a.speed):(t.show(a.animation,a.option,a.speed),this._fireOnShow())}else s?info.childrenFrame.hide():(info.childrenFrame.show(),this._fireOnShow())},onItemClick:function(t){var i=t.currentTarget,e=$(i).data("data"),s=GSI.Utils.getScreenSize();if(e.parent&&e.parent.children)for(var a=0;a<e.parent.children.length;a++)this.hideChildren(e.parent.children[a]);if(e&&e.childrenFrame)if(e.childrenFrame.is(":visible"))this.hideChildren(e);else{var n=$(i).offset();e.depth>=1?n.top+=Math.floor($(i).outerHeight(!0)/2):n.top+=Math.floor($(i).outerHeight(!0)+2),e.childrenFrame.css({visibility:"hidden"}).show();var o=e.childrenFrame.outerHeight(!0),r=e.childrenFrame.outerWidth(!0);e.childrenFrame.css({visibility:"visible"}).hide(),n.top+o>s.h&&(n.top-=n.top+o-s.h,n.top<0&&(n.top=0)),"left"==this.options.position?(n.top+o>s.h&&(n.top-=n.top+o-s.h,n.top<0&&(n.top=0)),e.depth>=1&&(n.left+=Math.floor($(i).outerWidth(!0)-30)),e.childrenFrame.css({left:n.left+"px",top:n.top+"px"}),e.depth<=0?this.showChildFrame(e.childrenFrame,!0,{direction:"up"}):this.showChildFrame(e.childrenFrame,!1,{origin:["top","left"]})):(e.depth>=1?n.left-=r-30:(n.left+=Math.floor($(i).outerWidth(!0)),n.left-=r),n.left<0&&(n.left=0),e.childrenFrame.css({left:n.left+"px",top:n.top+"px"}),e.depth<=0?this.showChildFrame(e.childrenFrame,!0,{direction:"up"}):this.showChildFrame(e.childrenFrame,!1,{origin:["top","right"]}))}else e&&(e.href&&""!=e.href&&this.openLink(e.href),this.options.onMenuItemClick&&this.options.onMenuItemClick(e.id),this.hide())},hide:function(t){this.hideChildren(this.rootItem,t)},onCheckBoxClick:function(t,i){var e=t.data("data");this.options.onCheckItemClick&&this.options.onCheckItemClick(e.id,t.is(":checked"))},openLink:function(t){var i=GSI.Links.getURL(t,this.map.getCenter().wrap(),this.map.getZoom());i&&(window.open(i),$(this.topSelector+" span").removeClass("selected"),$(this.topSelector+" ul").hide())}}),GSI.DialogManager=L.Class.extend({dialogList:[],visibleList:[],initialize:function(){},append:function(t){this.dialogList.push(t)},appendVisibleList:function(t){for(var i=0;i<this.visibleList.length;i++){var e=this.visibleList[i];if(e==t){this.visibleList.splice(i,1);break}}this.adjust(t),this.visibleList.push(t),this.refreshZIndex(),this._onWindowResize||(this._onWindowResize=L.bind(this.onWindowResize,this),$(window).on("resize",this._onWindowResize))},removeVisibleList:function(t){for(var i=0;i<this.visibleList.length;i++){var e=this.visibleList[i];if(e==t){this.visibleList.splice(i,1);break}}this.refreshZIndex(),this.visibleList.length<=0&&this._onWindowResize&&($(window).off("resize",this._onWindowResize),this._onWindowResize=null)},activate:function(t){this.appendVisibleList(t)},refreshZIndex:function(){for(var t=1e4,i=1,e=0;e<this.visibleList.length-1;e++){var s=.6+.4/this.visibleList.length*i;this.visibleList[e].css({"z-index":t,opacity:s}),this.visibleList[e].addClass("deactive"),t++,i++}this.visibleList.length>0&&(this.visibleList[this.visibleList.length-1].css({"z-index":t,opacity:.95}),this.visibleList[e].removeClass("deactive"))},adjust:function(t,i){i||(i=GSI.Utils.getScreenSize());var e=t.container.is(":visible");e||(t.container.css({visibility:"hidden"}),t.container.show());var s=t.container.offset(),a=t.container.outerWidth(!0),n=t.container.outerHeight(!0),o=null,r=null;if(!t.isResizable())if(i.h>i.w){var l=Math.floor(.9*i.w);t.options.width>l?(t.container.css({"max-width":l}),a=l):(t.container.css({"max-width":t.options.width}),a=t.options.width)}else{var l=Math.floor(.6*i.w);t.options.width>l?(t.container.css({"max-width":l}),a=l):(t.container.css({"max-width":t.options.width}),a=t.options.width)}t._userResized||(i.h>i.w?t.setMaxScrollHeight(Math.floor(.4*i.h)):t.setMaxScrollHeight(Math.floor(.65*i.h))),s.left>i.w-a/2&&(o=i.w-a/2),s.left<=-(a/2)&&(o=-Math.floor(a/2),t.container.css({left:-Math.floor(a/2)+"px"})),null!=o&&t.container.css({left:o+"px"}),s.top>i.h-n/2&&(r=i.h-n/2),s.top<0&&(r=0),null!=r&&t.container.css({top:r+"px"}),e||(t.container.hide(),t.container.css({visibility:"visible"}))},onWindowResize:function(){for(var t=GSI.Utils.getScreenSize(),i=0;i<this.visibleList.length;i++){var e=this.visibleList[i];this.adjust(e,t)}}}),GSI.Dialog=L.Class.extend({options:{containerClass:"gsi_dialog",headerClass:"gsi_dialog_header",contentClass:"gsi_dialog_content",effect:null,top:0,left:0,width:300,resizable:""},_userResized:!1,initialize:function(t){t=L.setOptions(this,t),GSI.Dialog._dialogManager||(GSI.Dialog._dialogManager=new GSI.DialogManager),GSI.Dialog._dialogManager.append(this),this.create(),t.visible&&this.show()},isResizable:function(){return this.options.resizable&&""!=this.options.resizable?!0:!1},createHeader:function(){return $("<span>").html("　　　　　　　")},createContent:function(){return $("<div>").html("　　　　　　　")},create:function(){if(!this.container){this.container=$("<div>").addClass(this.options.containerClass),this.headerFrame=$("<div>").addClass(this.options.headerClass),this.contentFrame=$("<div>").addClass(this.options.contentClass),this.closeBtn=$("<a>").html("×").attr({href:"javascript:void(0);"}).addClass("closebtn"),this.headerTitle=$("<div>").addClass("title"),this.headerFrame.append(this.headerTitle),this.headerFrame.append(this.closeBtn),this.headerTitle.append(this.createHeader()),this.contentFrame.append(this.createContent()),this.container.append(this.headerFrame),this.container.append(this.contentFrame),$(document.body).append(this.container),this.container.draggable({delay:100,scroll:!1,handle:this.headerFrame,stop:L.bind(function(){GSI.Dialog._dialogManager.adjust(this)},this)}).on("mousedown",L.bind(this.onClick,this)).on("touchstart",L.bind(this.onClick,this)),this.options.width&&this.container.css({width:this.options.width}),this.closeBtn.click(L.bind(function(){this.hide(!0)},this)),this.container.hide();var t=this.options.left;if("center"==t){var i=GSI.Utils.getScreenSize();t=Math.floor(i.w/2-this.options.width/2)}this.container.css({left:t+"px",top:this.options.top+"px",width:this.options.width+"px","min-width":"80px",height:"auto"}),this.isResizable()&&this.container.resizable({resize:L.bind(function(){this._onResize(),this._userResized=!0},this),handles:this.options.resizable})}},css:function(t){this.container&&this.container.css(t)},_onResize:function(){},addClass:function(t){this.container&&this.container.addClass(t)},removeClass:function(t){this.container&&this.container.removeClass(t)},show:function(){this.container||this.create(),GSI.Dialog._dialogManager.appendVisibleList(this),this.options.effect?this.container.show(this.options.effect.animation,this.options.effect.option,this.options.effect.speed,L.bind(function(){this.afterShow&&this.afterShow()},this)):this.container.show(L.bind(function(){this.afterShow&&this.afterShow()},this))},hide:function(){GSI.Dialog._dialogManager.removeVisibleList(this),this.options.effect?this.container.hide(this.options.effect.animation,this.options.effect.option,this.options.effect.speed):this.container.hide()},setMaxScrollHeight:function(t){},getVisible:function(){return this.container&&this.container.is(":visible")?!0:!1},onClick:function(){GSI.Dialog._dialogManager.activate(this)}}),GSI.LayerTreeDialog=GSI.Dialog.extend({options:{title:"表示できる情報"},initialize:function(t,i,e){this.mapLayerList=t,this.cocoTileLayer=i,this.mapLayerList.on("change",L.bind(this.onMapLayerListChange,this)),GSI.Dialog.prototype.initialize.call(this,e),i.on("load",L.bind(this.onCOCOTileLoad,this)),i.on("hide",L.bind(this.onCOCOTileHide,this))},createHeader:function(){return this._titleFrame=$("<div>"),this._titleTextFrame=$("<div>").append($("<span>").html(this.options.title)),this._titleFrame.append(this._titleTextFrame),this._titleFrame},_onResize:function(){GSI.Dialog.prototype._onResize.call(this);var t=this.container.outerHeight(!1)-this.headerFrame.outerHeight(!0)-this._controlFrame.outerHeight(!0)-9;this.listFrame.css({"max-height":"none",height:t+"px"})},createContent:function(){this._contentFrame=$("<div>"),this._controlFrame=this._createControl(),this.listFrame=$("<div>").addClass("layertreedialog_ul_frame"),this.listContainer=$("<ul>").addClass("layertreedialog_ul");var t=$("<li>").addClass("nodata").html("読み込み中");return this.listContainer.append(t),this.listFrame.append(this.listContainer),this._contentFrame.append(this._controlFrame),this._contentFrame.append(this.listFrame),this._contentFrame},_createControl:function(){var t=$("<div>").addClass("layertreedialog_control_frame"),i=new GSI.OnOffSwitch({className:"onoff",checked:this.cocoTileLayer.getVisible(),title:""}),e=$("<div>"),s=$("<label>").css({"padding-left":"5px"}).attr({"for":i.getId()}).html("表示範囲に絞込み");return i.on("change",L.bind(this._onCocoTileCheckChange,this,i)),e.append(i.getElement()),e.append(s),this._showAllButton=$("<a>").attr({href:"javascript:void(0);"}).html("全表示").addClass("normalbutton showallbutton"),this._hideAllButton=$("<a>").attr({href:"javascript:void(0);"}).html("全非表示").addClass("normalbutton showallbutton"),t.append(this._hideAllButton),t.append(this._showAllButton),t.append(e),this._showAllButton.click(L.bind(this._onShowAllClick,this)),this._hideAllButton.click(L.bind(this._onHideAllClick,this)),t},_onCocoTileCheckChange:function(t){this.cocoTileLayer.setVisible(t.checked())},setMaxScrollHeight:function(t){this.listFrame&&this.listFrame.css({"max-height":t+"px"}),this._contentFrame&&(this._contentFrame.css({height:"auto"}),this.contentFrame.css({height:"auto"}),this.container.css({height:"auto"}))},setTree:function(t){this.tree=t,this.current=null,this.initializeList()},show:function(){GSI.Dialog.prototype.show.call(this)},hide:function(){this._hideItemTooltip(),CONFIG.LAYERTREEDIALOGKEEPCURRENT||(this.current=null,this.initializeList()),GSI.Dialog.prototype.hide.call(this)},onCOCOTileLoad:function(t){this.tree&&this._initializeList(this.current?this.current.entries:this.tree,!0)},onCOCOTileHide:function(t){this.tree&&this._initializeList(this.current?this.current.entries:this.tree,!0)},initializeList:function(){this.contentFrame&&(this._hideItemTooltip(),this.listContainer||(this.listContainer=$("<ul>").addClass("layertreedialog_ul"),this.listFrame.empty().append(this.listContainer)),this.contentFrame.scrollTop(0),this.listContainer.empty(),this.current&&this.current.toggleall?(this._showAllButton.show(),this._hideAllButton.show()):(this._showAllButton.hide(),this._hideAllButton.hide()),this.options.currentPath&&(this.current=this._setCurrentPath(this.options.currentPath),this.options.currentPath=null),this.refreshTitle(),this._initializeList(this.current?this.current.entries:this.tree),this._userResized&&this._onResize())},_setCurrentPath:function(t){var i=null;if(!t||""==t)return null;for(var e=t.split("/"),s=this.tree,a=!1,n=0;n<e.length;n++){var o=e[n];a=!1;for(var r=0;r<s.length;r++)if(s[r].entries&&s[r].id==o){a=!0,i=s[r],s=s[r].entries;break}if(!a)break}return i},getCurrentPath:function(){for(var t=this.current,i="";t;)""!=i&&(i="/"+i),i=t.id+i,t=t.parent;return i},refreshTitle:function(){this._titleTextFrame.empty();for(var t=0,i=this.current;i;){if(t>0){var e=$("<a>").html(i.title).attr({href:"javascript:void(0);"}),s=$("<span>").html("&nbsp;&gt;&nbsp;");this._titleTextFrame.prepend(s),e.click(L.bind(this.onFolderClick,this,e)).data({data:i}),this._titleTextFrame.prepend(e)}else{var s=$("<span>").html(i.title);this._titleTextFrame.prepend(s)}t++,i=i.parent}if(t>0){var s=$("<span>").html("&nbsp;&gt;&nbsp;");this._titleTextFrame.prepend(s);var e=$("<a>").html(this.options.title).attr({href:"javascript:void(0);"});e.click(L.bind(this.onFolderClick,this,e)).data({data:null}),this._titleTextFrame.prepend(e)}else{var s=$("<span>").html(this.options.title);this._titleTextFrame.prepend(s)}},_makeFolder:function(t,i,e){var s=this.cocoTileLayer.getVisible(),a=e.entries.length,n=!0;if(s){var o=function(t,i){for(var e=0,s=0,a=0;a<t.length;a++){var n=t[a];if(n.entries){var r=o(n.entries,!1);e+=r.total,i&&r.total>0&&s++}else(!n.cocotile||n.hasTile)&&(s++,e++)}return{current:s,total:e}},r=o(e.entries,!0);a=r.current,r.total<=0&&(n=!1)}var l=$("<div>").addClass("title").html(e.title),h=$("<div>").addClass("num").append($("<span>").html(a));i.addClass("folder").append(l).append(h).click(L.bind(this.onFolderClick,this,i)),n?(i.removeClass("nococotile"),t.removeClass("nococotile")):(i.addClass("nococotile"),t.addClass("nococotile"))},_onLayerMouseEnter:function(t,i){this._toolTipViewCounter||(this._toolTipViewCounter=0),this._toolTipViewCounter++,this._showItemTooltip(t,i)},_onLayerMouseLeave:function(t,i){this._hideItemTooltip(t,i)},_makeToolTip:function(t){var i=$("<div>").addClass("layerinfo").css({"max-width":"350px"}),e=null,s=null;if(t.legendUrl&&""!=t.legendUrl&&(e=$("<a>").html("凡例を表示").addClass("legend").attr({href:t.legendUrl,target:"_blank"})),e&&i.append(e),t._visibleInfo){var a=$("<table>").addClass("slider_frame"),n=$("<tbody>"),o=$("<tr>"),r=$("<div>").addClass("slider"),l=t._visibleInfo?t._visibleInfo.opacity:1,h=Math.round(100-100*l),d=$("<td>").css({width:"100px"});d.text("透過率:"+h+"%").css({"white-space":"nowrap"}),o.append(d),o.append($("<td>").append(r).css({width:"150px"})),n.append(o),a.append(n),i.append(a);var c=L.bind(function(t,i){var e=i.slider("option","value"),s=Math.floor(e);d.text("透過率:"+s+"%").css({"white-space":"nowrap"}),e=(100-e)/100,t._visibleInfo.layer.setOpacity(e),t._visibleInfo.opacity=e,t._opacityChange&&t._opacityChange(e)},this,t,r);r.slider({range:"min",min:0,max:100,value:Math.round(100-100*l),slide:c,change:c,stop:c})}return t.html&&(s=$("<div>").addClass("description").html(t.html)),s&&i.append(s),i},_showItemTooltip:function(t,i){if(i){if(this._curItem){if(this._toolTipViewCounter%2==0){if(this._curItem==i)return this._curItem=void 0,void(this._toolTipViewCounter=0);this._toolTipViewCounter--}this._curItem=i}else this._curItem=i;this._itemTooltip||(this._itemTooltip=$("<div>").addClass("gsi_layertreedialog_itemtooltip").hide(),$(document.body).append(this._itemTooltip));var e=t.offset(),s=GSI.Utils.getScreenSize(),a=e.left+parseInt(t.outerWidth(!0)),n=e.top;a>.6*s.w&&(a=e.left+parseInt(.3*t.outerWidth(!0)),n=e.top+t.outerHeight(!0)),this._itemTooltip.css({left:a+"px",top:n+"px"}).empty().append(this._makeToolTip(i)),this._itemTooltip.stop().hide().fadeIn("normal"),this._hideToolTipHandler&&($(document.body).unbind("mousedown",this._hideToolTipHandler),$(document.body).unbind("touchstart",this._hideToolTipHandler),this.listFrame.unbind("scroll",this._hideToolTipHandler),this._hideToolTipHandler=null),this._hideToolTipHandler=L.bind(function(t){if(this._itemTooltip&&t.target!=this._itemTooltip[0]){for(var i=$(t.target).parents(),e=0;e<i.length;e++)if(i[e]==this._itemTooltip[0])return;this._hideItemTooltip(),"scroll"==t.type&&(this._toolTipViewCounter=0)}},this),$(document.body).bind("mousedown",this._hideToolTipHandler),$(document.body).bind("touchstart",this._hideToolTipHandler),this.listFrame.bind("scroll",this._hideToolTipHandler)}else this._hideItemTooltip()},_hideItemTooltip:function(t,i){this._hideToolTipHandler&&($(document.body).unbind("mousedown",this._hideToolTipHandler),$(document.body).unbind("touchstart",this._hideToolTipHandler),this.listFrame.unbind("scroll",this._hideToolTipHandler),this._hideToolTipHandler=null),this._itemTooltip&&this._itemTooltip.stop().hide()},_makeLayer:function(t,i,e){var s=this.cocoTileLayer.getVisible(),a=$("<div>").addClass("title").html(e.title),n=e.iconUrl;if(n||(n=CONFIG.LAYERTYPELIST[e.layerType]&&CONFIG.LAYERTYPELIST[e.layerType].isTile?CONFIG.DEFAULTIMAGE.TILEICON:CONFIG.DEFAULTIMAGE.FILEICON),e._visibleInfo){var o=$("<span>").addClass("viewmark").html("表示");i.append(o),i.addClass("view")}else i.removeClass("view");i.addClass("item").append(a);var r=$("<a>").attr({href:"javascript:void(0);"}).addClass("description_btn").html("詳細");if(t.append(r),r.unbind("click").bind("click",L.bind(this._onLayerMouseEnter,this,i,e)),a.css({background:"url("+n+") no-repeat 8px 50%","background-size":"16px 16px"}),CONFIG.VISIBLELAYERTYPE){var l=$("<div>").addClass("info");if(e.cocotile){var h=$("<span>").addClass("cocotile").html("ココタイル");l.append(h)}var d=CONFIG.LAYERTYPELIST[e.layerType];d||(d={caption:e.layerType});var h=$("<span>").html(d.caption).addClass("layertype");l.append(h),t.append(l)}s&&e.cocotile&&!e.hasTile?(i.removeClass("view"),i.addClass("nococotile"),t.addClass("nococotile")):(i.removeClass("nococotile"),t.removeClass("nococotile")),i.click(L.bind(this.onItemClick,this,i))},_onShowAllClick:function(){var t=this.cocoTileLayer.getVisible(),i=this.current?this.current.entries:this.tree;if(i&&!(i.length<=0)){for(var e=[],s=0;s<i.length;s++){var a=i[s];a.entries||t&&a.cocotile&&!a.hasTile||e.push(a)}e.length>0&&this.mapLayerList.appendList(e)}},_onHideAllClick:function(){var t=this.current?this.current.entries:this.tree;if(t&&!(t.length<=0))for(var i=0;i<t.length;i++){var e=t[i];e.entries||this.mapLayerList.exists(e)&&this.mapLayerList.remove(e)}},_initializeList:function(t,i){if(this._hideItemTooltip(),!t||t.length<=0){this.listContainer.empty();var e=$("<li>").addClass("nodata").html("データがありません");return void this.listContainer.append(e)}for(var s=i?this.listContainer.children("li"):null,a=!1,n=!1,o=0;o<t.length;o++){var r=t[o],e=i?$(s[o]).empty():$("<li>"),l=$("<a>").attr({href:"javascript:void(0);"});l.data({data:r}),r.entries?this._makeFolder(e,l,r):this._makeLayer(e,l,r),e.append(l),this.listContainer.append(e),r.entries||this.cocoTileLayer.getVisible()&&r.cocotile&&!r.hasTile||(r._visibleInfo?n=!0:a=!0)}a?this._showAllButton.removeClass("disabled"):this._showAllButton.addClass("disabled"),n?this._hideAllButton.removeClass("disabled"):this._hideAllButton.addClass("disabled")},onFolderClick:function(t){var i=t.data("data");this.current=i,this.listContainer.fadeOut("fast",L.bind(function(){this.listContainer.fadeIn("fast"),this.initializeList()},this))},onItemClick:function(t){var i=t.data("data");this.mapLayerList.exists(i)?this.mapLayerList.remove(i):this.mapLayerList.append(i)},onMapLayerListChange:function(){this._initializeList(this.current?this.current.entries:this.tree,!0),this._toolTipViewCounter=0}}),GSI.ViewListDialog=GSI.Dialog.extend({options:{title:"表示中の情報"},initialize:function(t,i,e,s){this.map=t,this.mapLayerList=i,this.cocoTileLayer=e,this.mapLayerList.on("change",L.bind(this.onMapLayerListChange,this)),GSI.Dialog.prototype.initialize.call(this,s),e.on("load",L.bind(this.onCOCOTileLoad,this)),e.on("hide",L.bind(this.onCOCOTileHide,this))},_onResize:function(){GSI.Dialog.prototype._onResize.call(this);var t=this.container.outerHeight(!1)-this.headerFrame.outerHeight(!0)-this._controlFrame.outerHeight(!0)-8;this.listFrame.css({"max-height":"none",height:t+"px"})},createHeader:function(){return $("<span>").html(this.options.title)},createContent:function(){this._contentFrame=$("<div>"),this._controlFrame=this._createControl(),this.listFrame=$("<div>").addClass("viewlistdialog_ul_frame"),this.listContainer=$("<ul>").addClass("viewlistdialog_ul");var t=$("<li>").addClass("nodata").html("表示中の情報はありません");return this.listContainer.append(t),this.listFrame.append(this.listContainer),this._contentFrame.append(this._controlFrame),this._contentFrame.append(this.listFrame),this._contentFrame},_createControl:function(){var t=$("<div>").addClass("viewlistdialog_control_frame");this._showAllButton=$("<a>").attr({href:"javascript:void(0);"}).html("全表示").addClass("normalbutton showallbutton"),this._hideAllButton=$("<a>").attr({href:"javascript:void(0);"}).html("全非表示").addClass("normalbutton showallbutton"),this._removeAllButton=$("<a>").attr({href:"javascript:void(0);"}).html("全削除").addClass("normalbutton showallbutton"),t.append(this._removeAllButton),t.append(this._hideAllButton),t.append(this._showAllButton);var i=$("<div>").html("&nbsp;").css({"font-size":"9.5pt"});return t.append(i),this._showAllButton.click(L.bind(this._onShowAllClick,this)),this._hideAllButton.click(L.bind(this._onHideAllClick,this)),this._removeAllButton.click(L.bind(this._onRemoveAllClick,this)),t},_onShowAllClick:function(){this._showAll(this.mapLayerList.getList()),this._showAll(this.mapLayerList.getTileList())},_onHideAllClick:function(){this._hideAll(this.mapLayerList.getList()),this._hideAll(this.mapLayerList.getTileList())},_onRemoveAllClick:function(){this._removeAll()},_showAll:function(t){for(var i=0;i<t.length;i++){var e=t[i];e._visibleInfo._isHidden&&(e._onOffSwitch.checked(!0),e._visibleInfo._isHidden=!1,this.map.addLayer(e._visibleInfo.layer))}},_hideAll:function(t){for(var i=0;i<t.length;i++){var e=t[i];e._visibleInfo._isHidden||(e._onOffSwitch.checked(!1),e._visibleInfo._isHidden=!0,this.map.removeLayer(e._visibleInfo.layer))}},_removeAll:function(){this.mapLayerList.clear()},setMaxScrollHeight:function(t){this.listFrame&&this.listFrame.css({"max-height":t+"px"}),this._contentFrame&&this._contentFrame.css({height:"auto"}),this.contentFrame&&this.contentFrame.css({height:"auto"}),this.container&&this.container.css({height:"auto"})},show:function(){GSI.Dialog.prototype.show.call(this)},initializeList:function(){this.contentFrame&&(this.listContainer||(this.listContainer=$("<ul>").addClass("viewlistdialog_ul"),this.listFrame.empty().append(this.listContainer)),this.tileListContainer||(this.tileListContainer=$("<ul>").addClass("viewlistdialog_ul"),this.listFrame.append(this.tileListContainer),this.tileListContainer.sortable({cursor:"move",update:L.bind(this.onSortChange,this),handle:".item_frame",scroll:!1}),this.tileListContainer.disableSelection()),this.contentFrame.scrollTop(0),this.listContainer.empty(),this.tileListContainer.empty(),this._initializeList(),this._userResized&&this._onResize())},onSortChange:function(t,i){for(var e=this.tileListContainer.find("li"),s=[],a=0;a<e.length;a++){var n=$(e[a]).data("data");n&&s.push(n)}this.mapLayerList.refreshTileList(s)},onCOCOTileLoad:function(t){this._initializeList(!0)},onCOCOTileHide:function(t){this._initializeList(!0)},makePankzu:function(t){t=t.parent;for(var i="";t;)i=t.title+(""==i?"":"&gt;")+i,t=t.parent;return i},_updateLayer:function(t,i,e){var s=this.cocoTileLayer.getVisible();s&&i.cocotile&&!i.hasTile?t.addClass("nococotile"):t.removeClass("nococotile")},_makeLayer:function(t,i,e){var s=$("<div>").addClass("item_frame");e&&s.addClass("tile"),t.data({data:i});var a=new GSI.OnOffSwitch({className:"visible",checked:i._visibleInfo._isHidden?!1:!0});checkFrame=a.getElement(),checkFrame.css({position:"absolute",right:"42px",top:"6px"}),a.on("change",L.bind(this.onToggleClick,this,t,a)),i._onOffSwitch=a,t.append(checkFrame);var n=$("<a>").attr({href:"javascript:void(0);"}).addClass("closebtn").html("削除").click(L.bind(this.onRemoveClick,this,t));t.append(n);var o=$("<a>").attr({href:"javascript:void(0);"}).addClass("titleframe"),r=$("<div>").addClass("title"),l=i.iconUrl;l||(l=CONFIG.LAYERTYPELIST[i.layerType]&&CONFIG.LAYERTYPELIST[i.layerType].isTile?CONFIG.DEFAULTIMAGE.TILEICON:CONFIG.DEFAULTIMAGE.FILEICON);var h=$("<div>").addClass("pankuzu").html(this.makePankzu(i));
r.html(i.title),o.append(h).append(r),o.css({background:"url("+l+") no-repeat 4px 50%","background-size":"16px 16px"}),o.append(r),s.append(o),t.append(s);var d=$("<div>").addClass("layerinfo"),c=null,p=null;i.legendUrl&&""!=i.legendUrl&&(c=$("<a>").html("凡例を表示").addClass("legend").attr({href:i.legendUrl,target:"_blank"})),i.html&&(p=$("<div>").addClass("description").html(i.html));var u=$("<table>").addClass("slider_frame"),m=$("<tbody>"),f=$("<tr>"),_=$("<div>").addClass("slider"),g=i._visibleInfo?i._visibleInfo.opacity:1,v=Math.round(100-100*g),I=$("<td>").css({width:"100px"});I.text("透過率:"+v+"%").css({"white-space":"nowrap"}),f.append(I),f.append($("<td>").append(_).css({width:"150px"})),m.append(f),u.append(m),c&&d.append(c),d.append(u),p&&d.append(p);var g=i._visibleInfo?i._visibleInfo.opacity:1;i._opacityChange=function(t){_&&_.slider("value",Math.round(100-100*t))};var S=L.bind(function(t,i){var e=i.slider("option","value"),s=Math.floor(e);I.text("透過率:"+s+"%").css({"white-space":"nowrap"}),e=(100-e)/100;var a=t.data("data");a._visibleInfo.layer.setOpacity(e),a._visibleInfo.opacity=e},this,t,_);_.slider({range:"min",min:0,max:100,value:Math.round(100-100*g),slide:S,change:S,stop:S});var y=this.cocoTileLayer.getVisible();y&&i.cocotile&&!i.hasTile?t.addClass("nococotile"):t.removeClass("nococotile"),t.append(d),o.click(L.bind(this.onItemClick,this,t)),i._visibleInfo.infoShowing&&(r.addClass("open"),d.show())},_mkla:function(){var t=this.cocoTileLayer.getVisible(),i=($("<div>").addClass("titleframe"),$("<div>").addClass("title"),item.iconUrl);i||(i=CONFIG.DEFAULTIMAGE.FILEICON),CONFIG.LAYERTYPELIST[item.layerType]&&CONFIG.LAYERTYPELIST[item.layerType].isTile&&(i=CONFIG.DEFAULTIMAGE.TILEICON),a.click(L.bind(this.onItemClick,this,a));var e=null,s=null;item.legendUrl&&""!=item.legendUrl&&(e=$("<a>").html("関連情報を表示").addClass("legend").attr({href:item.legendUrl,target:"_blank"})),item.description&&(s=$("<div>").addClass("description").html(item.description));var n=$("<div>").addClass("slider");a.data({opacitySlider:n});var o=$("<div>").addClass("layerinfo");e&&o.append(e),s&&o.append(s),o.append(n);var r=item._visibleInfo?item._visibleInfo.opacity:1,l=L.bind(function(t,i){var e=i.slider("option","value");e=(100-e)/100;var s=t.data("data");s._visibleInfo.layer.setOpacity(e),s._visibleInfo.opacity=e},this,a,n);n.slider({range:"min",min:0,max:100,value:Math.floor(100*(1-r)),slide:l,change:l,stop:l}),li.append(o),t&&item.cocotile&&!item.hasTile&&a.addClass("nococotile"),item._visibleInfo.infoShowing&&o.show()},_initializeList:function(t){var i=this.mapLayerList.getList(),e=this.mapLayerList.getTileList();if(i.length<=0&&e.length<=0){this.listContainer.empty();var s=$("<li>").addClass("nodata").html("表示中の情報はありません");this.listContainer.append(s)}var a=t?this.listContainer.children("li"):null,n=this.listContainer;this._initializeListOne(i,a,n,t),this.tileListContainer&&(a=t?this.tileListContainer.children("li"):null,n=this.tileListContainer,this._initializeListOne(e,a,n,t,!0),this.tileListContainer.sortable("refresh"))},_initializeListOne:function(t,i,e,s,a){for(var n=0;n<t.length;n++){var o=t[n],r=s?$(i[n]):$("<li>");s?this._updateLayer(r,o,a):this._makeLayer(r,o,a),s||e.append(r)}},onItemClick:function(t){var i=t.data("data"),e=t.find(".layerinfo");e.is(":visible")?(i._visibleInfo.infoShowing=!1,e.slideUp("fast",L.bind(function(){this._userResized&&this._onResize()},this)),t.find(".title").removeClass("open")):(i._visibleInfo.infoShowing=!0,e.slideDown("fast",L.bind(function(){this._userResized&&this._onResize()},this)),t.find(".title").addClass("open"))},onMapLayerListChange:function(){this.initializeList()},onToggleClick:function(t,i){var e=t.data("data");i.checked()?(e._visibleInfo._isHidden=!1,this.map.addLayer(e._visibleInfo.layer)):(e._visibleInfo._isHidden=!0,this.map.removeLayer(e._visibleInfo.layer))},onRemoveClick:function(t){var i=t.data("data");t.fadeOut("fast",L.bind(function(t){this.mapLayerList.remove(i),t.remove(),this._userResized&&this._onResize()},this,t))}}),GSI.OpacitySlider=L.Class.extend({includes:L.Mixin.Events,options:{value:1},element:null,initialize:function(t){t=L.setOptions(this,t),this.opacity=t.value,this.element=$("<div>").addClass("gsi_opacity_slider"),this.bg=$("<div>").addClass("gsi_opacity_slider_bg"),this.element.append(this.bg),this.btn=$("<div>").addClass("gsi_opacity_slider_btn").draggable({containment:this.element,scroll:!1,drag:L.bind(function(t,i){var e=this.element.outerWidth(!1)-24;this.opacity=1-i.position.left/e,this.fire("change",this.opacity)},this)}),this.element.append(this.btn)},refresh:function(t){this.opacity=t;var i=this.element.outerWidth(!1)-24,e=Math.floor(i*(1-this.opacity));this.btn.css({left:e})},getElement:function(){return this.element},getOpacity:function(){return this.opacity}}),GSI.Draw.convertRadius=function(t){var i={radius:t.toFixed(1),unit:"m"};return i.radius>1e3&&(i.radius=(t/1e3).toFixed(4),i.unit="km"),i},GSI.Draw.Circle=L.Draw.Circle.extend({_onMouseMove:function(t){var i,e=t.latlng,s=this.options.showRadius,a=this.options.metric;this._tooltip.updatePosition(e),this._isDrawing&&(this._drawShape(e),i=this._shape.getRadius().toFixed(1),this._tooltip.updateContent({text:this._endLabelText,subtext:s?"半径: "+L.GeometryUtil.readableDistance(i,a):""})),this._isDrawing&&this.fire("change",GSI.Draw.convertRadius(this._shape.getRadius()))}}),L.FeatureGroup.include({closePopup:function(){for(var t in this._layers)this._layers[t].closePopup();return this},unbindPopup:function(){for(var t in this._layers)this._layers[t].unbindPopup();return this}}),GSI.PixelRectangle=L.Polygon.extend({initialize:function(t,i,e,s,a,n){this._center=t,this._width=i,this._height=e,this._anchorX=s,this._anchorY=a,L.Polygon.prototype.initialize.call(this,[this._center,this._center,this._center],n)},onZoomEnd:function(){this.setLatLngs(this._boundsToLatLngs(this._center,this._width,this._height,this._anchorX,this._anchorY))},onAdd:function(t){L.Polygon.prototype.onAdd.call(this,t),this.setLatLngs(this._boundsToLatLngs(this._center,this._width,this._height,this._anchorX,this._anchorY)),this._onZoomEnd=L.bind(this.onZoomEnd,this),t.on("zoomend",this._onZoomEnd)},onRemove:function(t){t.off("zoomend",this._onZoomEnd),L.Polygon.prototype.onRemove.call(this,t)},_boundsToLatLngs:function(t,i,e,s,a){var n=this._map.latLngToContainerPoint(t),o=n.x-s,r=n.y-a,l=n.x+(i-s),h=n.y+(e-a),d=this._map.containerPointToLatLng(L.point(o,h)),c=this._map.containerPointToLatLng(L.point(l,r));return latLngBounds=L.latLngBounds(d,c),[latLngBounds.getSouthWest(),latLngBounds.getNorthWest(),latLngBounds.getNorthEast(),latLngBounds.getSouthEast()]}}),GSI.Draw.Polyline=L.Draw.Polyline.extend({initialize:function(t,i){GSI.Utils.Browser.isSmartMobile&&(i.touch=new L.DivIcon({iconSize:new L.Point(24,24),className:"leaflet-div-icon leaflet-editing-icon gsi_draw_icon"})),L.Draw.Polyline.prototype.initialize.call(this,t,i)},_vertexChanged:function(t,i){this._currentLatLng=t,L.Draw.Polyline.prototype._vertexChanged.call(this,t,i);var e,s=this._currentLatLng,a=this._markers[this._markers.length-1].getLatLng();e=this._measurementRunningTotal+s.distanceTo(a);var n="0 m";n=e>1e3?(e/1e3).toFixed(3)+" km":Math.ceil(e)+" m",this.fire("measurechange",{distance:n})}}),GSI.Draw.Polygon=L.Draw.Polygon.extend({initialize:function(t,i){GSI.Utils.Browser.isSmartMobile&&(i.icon=new L.DivIcon({iconSize:new L.Point(24,24),className:"leaflet-div-icon leaflet-editing-icon gsi_draw_icon"})),L.Draw.Polygon.prototype.initialize.call(this,t,i)},_vertexChanged:function(t,i){L.Draw.Polygon.prototype._vertexChanged.call(this,t,i),this.fire("measurechange",{distance:this._area2MeasurementString(L.GeometryUtil.geodesicArea(this._poly.getLatLngs()))})},_area2MeasurementString:function(t){var i="0 m&sup2;";return t&&(i=1e6>t?Math.ceil(t)+" m&sup2;":(t/1e6).toFixed(3)+" km&sup2;"),i},_getMeasurementString:function(){var t=this._area;return t?this._area2MeasurementString(t):null},_updateFinishHandler:function(){var t=this._markers.length;1===t&&this._markers[0].on("click",this._finishShape,this),t>2&&(this._markers[t-1].on("click",this._finishShape,this),t>3&&this._markers[t-2].off("click",this._finishShape,this))}}),GSI.Draw.FreehandPolyline=L.Draw.SimpleShape.extend({initialize:function(t,i){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end,this._initialLabelText="マウスダウンで線の描画開始",L.Draw.SimpleShape.prototype.initialize.call(this,t,i)},_drawShape:function(t){this._shape?this._shape.addLatLng(t):(this._shape=new L.Polyline([],this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Polyline(this._shape.getLatLngs(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)}}),GSI.MeasureDialog=GSI.Dialog.extend({options:{title:GSI.TEXT.MEASURE.DIALOG_TITLE,width:"200px"},initialize:function(t,i,e){this.map=t,this.mapMouse=i,GSI.Dialog.prototype.initialize.call(this,e)},onMeasureChange:function(t){this.measureLayer&&(this.map.removeLayer(this.measureLayer),this.measureLayer=null),this.distance.html(t.distance)},onMeasureTypeChange:function(){this.measureLayer&&(this.map.removeLayer(this.measureLayer),this.measureLayer=null),this.stopMeasure(),this.startMeasure()},onMeasurePathCreated:function(t){this.measureLayer=t.layer,this.map.addLayer(t.layer),this.polyLine&&(this.polyLine.disable(),this.polyLine=null),this.polygon&&(this.polygon.disable(),this.polygon=null),this.drawingItems&&(this.map.removeLayer(this.drawingItems),this.drawingItems=null),this.startMeasure()},startMeasure:function(){this.drawingItems||(this.mapMouse.setClickMoveEnable(!1),this.drawingItems=L.featureGroup().addTo(this.map),this.distanceRadio.is(":checked")?this.startDistanceMeasure():this.areaRadio.is(":checked")?this.startAreaMeasure():this.featureRadio.is(":checked")&&this.startFeatureMeasure())},startDistanceMeasure:function(){this.polyLin||(L.drawLocal.draw.handlers.polyline.tooltip.start="開始位置を選択",L.drawLocal.draw.handlers.polyline.tooltip.cont="次の位置を選択(最終点を2回クリックして終了)",L.drawLocal.draw.handlers.polyline.tooltip.end="次の位置を選択(最終点を2回クリックして終了)",this.polyLine=new GSI.Draw.Polyline(this.map,{shapeOptions:{stroke:!0,color:"#ee3333",weight:2,opacity:1,fill:!1,clickable:!0,dashArray:[3,3]},edit:{featureGroup:this.drawingItems},showLength:!0}),this.polyLine.on("measurechange",L.bind(this.onMeasureChange,this)),this.polyLine.enable())},startAreaMeasure:function(){this.polygon||(L.drawLocal.draw.handlers.polygon.tooltip.start="開始位置を選択",L.drawLocal.draw.handlers.polygon.tooltip.cont="次の位置を選択",L.drawLocal.draw.handlers.polygon.tooltip.end="次の位置を選択(最終点を2回クリックして終了)",this.polygon=new GSI.Draw.Polygon(this.map,{shapeOptions:{stroke:!0,color:"#ee3333",fillColor:"#ee3333",fillOpacity:.4,weight:2,opacity:1,fill:!0,clickable:!0,dashArray:[3,3]},edit:{featureGroup:this.drawingItems},showArea:!0,allowIntersection:!1}),this.polygon.on("measurechange",L.bind(this.onMeasureChange,this)),this.polygon.enable())},onLayerClick:function(t,i){var e=t.getLatLngs(),s=0,a=0,n=!1,o="";try{o=t.toGeoJSON().geometry.type,n="Polygon"==o}catch(i){}if("MultiPolygon"!=o){if(n){a=L.GeometryUtil.geodesicArea(e);var r="";r=a>=1e6?(a/1e6).toFixed(3)+"km&sup2;":Math.ceil(a)+"m&sup2;",this.distance.html("面積:"+r)}else{for(var l=1;l<e.length;l++)s+=e[l-1].distanceTo(e[l]);var h="";h=s>1e3?(s/1e3).toFixed(3)+"km":Math.ceil(s)+"m",this.distance.html("距離:"+h)}return!0}},startFeatureMeasure:function(){this.measureLayer=L.featureGroup(),this.rectStyle={color:"#ff3333",weight:2,fill:!1,opacity:.5,dashArray:[3,3]},this.map.eachLayer(L.bind(function(t){t.getBounds&&t.getLatLngs&&!t._layers&&!t._noMeasure&&(t._measureClickHandler&&(t.off("click",t._measureClickHandler),t.off("touchend",t._measureClickHandler)),t._measureClickHandler=L.bind(this.onLayerClick,this,t),t.on("click",t._measureClickHandler),this.measureLayer.addLayer(L.rectangle(t.getBounds(),this.rectStyle)))},this)),this.map.addLayer(this.measureLayer)},stopMeasure:function(){this.map.eachLayer(L.bind(function(t){t._measureClickHandler&&t.off("click",t._measureClickHandler)},this)),this.measureLayer&&(this.map.removeLayer(this.measureLayer),this.measureLayer=null),this.mapMouse.setClickMoveEnable(!0),this.distance.html("------"),this.polyLine&&(this.polyLine.disable(),this.polyLine=null),this.polygon&&(this.polygon.disable(),this.polygon=null),this.drawingItems&&(this.map.removeLayer(this.drawingItems),this.drawingItems=null)},show:function(){this._onMeasurePathCreated||(this._onMeasurePathCreated=L.bind(this.onMeasurePathCreated,this),this.map.on("draw:created",this._onMeasurePathCreated)),this.startMeasure(),GSI.Dialog.prototype.show.call(this)},hide:function(){this._onMeasurePathCreated&&(this.map.off("draw:created",this._onMeasurePathCreated),this._onMeasurePathCreated=null),this.stopMeasure(),GSI.Dialog.prototype.hide.call(this)},createHeader:function(){return this.title=$("<div>").html(this.options.title),$("<div>").append(this.title)},createContent:function(){return this.frame=$("<div>"),this.radioFrame=$("<div>"),this.distanceRadio=$("<input>").attr({id:"GSI_MeasureDialog_distance",type:"radio",name:"measure",checked:!0}).click(L.bind(this.onMeasureTypeChange,this)),this.distanceLabel=$("<label>").attr({"for":"GSI_MeasureDialog_distance"}).append(this.distanceRadio).append($("<span>").html(GSI.TEXT.MEASURE.DIALOG_DISTANCE_CAPTION)),this.areaRadio=$("<input>").attr({id:"GSI_MeasureDialog_area",type:"radio",name:"measure",checked:!1}).click(L.bind(this.onMeasureTypeChange,this)),this.areaLabel=$("<label>").attr({"for":"GSI_MeasureDialog_area"}).append(this.areaRadio).append($("<span>").html(GSI.TEXT.MEASURE.DIALOG_AREA_CAPTION)),this.featureRadio=$("<input>").attr({id:"GSI_MeasureDialog_feature",type:"radio",name:"measure",checked:!1}).click(L.bind(this.onMeasureTypeChange,this)),this.featureLabel=$("<label>").attr({"for":"GSI_MeasureDialog_feature"}).append(this.featureRadio).append($("<span>").html(GSI.TEXT.MEASURE.DIALOG_OBJECT_CAPTION)),this.radioFrame.addClass("gsi_measuredialog_radiofrane").append(this.distanceLabel).append(this.areaLabel).append(this.featureLabel),this.distance=$("<div>").html("------").addClass("gsi_measuredialog_result"),this.frame.append(this.radioFrame).append(this.distance),this.frame}}),GSI.Edit.Circle=L.Edit.Circle.extend({includes:L.Mixin.Events,_resize:function(t){L.Edit.Circle.prototype._resize.call(this,t);var i=GSI.Draw.convertRadius(this._shape.getRadius());this.fire("change",i)}}),GSI.Edit.Marker=L.Class.extend({includes:L.Mixin.Events,options:{},initialize:function(t,i){this.marker=t,this.marker&&(this._map=this.marker._map),i=L.setOptions(this,i)},setOptions:function(t){this.marker&&t.icon&&this.marker.setIcon(t.icon)},enable:function(){this.marker&&this.marker.dragging.enable()},disable:function(){this.marker&&this.marker.dragging.disable()}}),GSI.Edit.Poly=L.Edit.Poly.extend({updateMarkers:function(){this._moveMarker=null,L.Edit.Poly.prototype.updateMarkers.call(this)},updateMarkers2:function(){if(this._markerGroup)for(var t=this._markerGroup.getLayers(),i=0;i<t.length;i++)t[i]!=this._moveMarker&&this._markerGroup.removeLayer(t[i]);this._initMarkers()},_initMarkers:function(){if(L.Edit.Poly.prototype._initMarkers.call(this),!this._moveMarker){var t=this._poly.getBounds(),i=null;i=t.getCenter();var e=new L.Marker.Touch(i,{draggable:!0,icon:L.icon({iconUrl:"image/sakuzu/icon_move.png",iconSize:[24,24],iconAnchor:[32,32]})});e._origLatLng=i,e.on("drag",this._onCenterMarkerDrag,this).on("dragend",this._fireEdit,this).on("touchmove",this._onCenterMarkerDrag,this).on("touchend",this._fireEdit,this),this._moveMarker=e,this._markerGroup.addLayer(e)}},_onMarkerContextMenu:function(t){if(L.DomEvent.preventDefault(t),!t.target._isMiddleMarker){var i=this._poly._latlngs;this.options.isPolygon&&i.length<=3||!this.options.isPolygon&&i.length<=2||(i.splice(t.target._index,1),this._poly.setLatLngs(i),this.updateMarkers())}},_createMarker:function(t,i){var e=new L.Marker.Touch(t,{draggable:!0,icon:this.options.icon});return e._origLatLng=t,e._index=i,e.on("contextmenu",this._onMarkerContextMenu,this).on("drag",this._onMarkerDrag,this).on("dragend",this._fireEdit,this).on("touchmove",this._onTouchMove,this).on("touchend",this._fireEdit,this),this._markerGroup.addLayer(e),e},_removeMarker:function(t){var i=t._index;this._markerGroup.removeLayer(t),this._markers.splice(i,1),this._poly.spliceLatLngs(i,1),this._updateIndexes(i,-1),t.off("contextmenu",this._onMarkerContextMenu,this).off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("touchmove",this._onMarkerDrag,this).off("touchend",this._fireEdit,this).off("click",this._onMarkerClick,this)},_onCenterMarkerDrag:function(t){for(var i=t.target,e=this._poly._latlngs,s=i._latlng.lat-i._origLatLng.lat,a=i._latlng.lng-i._origLatLng.lng,n=0;n<e.length;n++)e[n].lat+=s,e[n].lng+=a;this._poly.setLatLngs(e),L.extend(i._origLatLng,i._latlng),this._poly.redraw(),this.updateMarkers2()}}),GSI.IconSelector=L.Class.extend({includes:L.Mixin.Events,iconList:[],options:{cols:10},initialize:function(t,i,e){this.image=t,this.image.css({cursor:"pointer"}),this.iconList=i?i:[],e=L.setOptions(this,e),this.image.click(L.bind(this.onClick,this))},onClick:function(){this.show()},onSelect:function(t){this.image.attr({src:t.url}),this.selectedIcon=t,this.fire("select",{selectedIcon:t}),this.hide()},setSelectedIcon:function(t){this.selectedIcon=null;for(var i=0;i<this.iconList.length;i++)if(this.iconList[i].url==t){this.selectedIcon=this.iconList[i];break}},create:function(){if(!this.container){this.container=$("<div>").addClass("gsi_iconselector").hide();for(var t=$("<table>"),i=$("<tbody>"),e=null,s=0,a=0;a<this.iconList.length;a++){var n=this.iconList[a];s=a%this.options.cols,0==s&&(e=$("<tr>"),i.append(e));var o=$("<td>"),r=$("<a>").attr({href:"javascript:void(0);"}).click(L.bind(this.onSelect,this,n)),l=$("<img>").attr({src:n.url});n.size&&l.css({width:n.size[0],height:n.size[1]}),r.append(l),o.append(r),e.append(o)}if(e)for(var a=s;a<this.options.cols;a++){var o=$("<td>").html("<br>");e.append(o)}t.append(i),this.container.append(t),this.container.css("overflow","scroll").css("height","500px"),$(document.body).append(this.container)}},show:function(){this.container||this.create();var t=GSI.Utils.getScreenSize(),i=this.image.offset(),e={w:0,h:0};this.container.is(":visible")?(e.w=this.container.outerWidth(!0),e.h=this.container.outerHeight(!0)):(this.container.css({visibility:"hidden"}),this.container.show(),e.w=this.container.outerWidth(!0),e.h=this.container.outerHeight(!0),this.container.hide(),this.container.css({visibility:"visible"}));var s={left:i.left-Math.floor(e.w/2),top:i.top+this.image.outerHeight(!0)};s.top+e.h>t.h&&(s.top=t.h-e.h),s.left+e.w>t.w&&(s.left=t.w-e.w),this.container.css({left:s.left+"px",top:s.top+"px"}),this.container.slideDown("fast"),this._onScreenMouseDown||(this._onScreenMouseDown=L.bind(this.onScreenMouseDown,this),$(document.body).on("mousedown",this._onScreenMouseDown))},hide:function(){this._onScreenMouseDown&&($(document.body).off("mousedown",this._onScreenMouseDown),this._onScreenMouseDown=null),this.container&&this.container.slideUp("fast")},onScreenMouseDown:function(t){if(this.container&&this.container[0]!=t.target){for(var i=$(t.target),e=i.parents(),s=0;s<e.length;s++)if(e[s]==this.container[0])return;this.hide()}}}),GSI.DivIcon=L.DivIcon.extend({options:{iconSize:null,className:"gsi-div-icon",html:!1},createIcon:function(t){var i=L.DivIcon.prototype.createIcon.call(this,t);return i}}),GSI.divIcon=function(t){return new GSI.DivIcon(t)},GSI.ShareDialog=GSI.Dialog.extend({options:{title:GSI.TEXT.SHARE.DIALOG_TITLE},initialize:function(t,i,e,s,a){this.map=t,this.pageStateManager=i,this.layersJSON=e,this.sakuzuList=s,GSI.Dialog.prototype.initialize.call(this,a)},show:function(t){switch(this._mode=t,this._createTextareaContent(!0),this._createSettingContent(),this._initializeSetting(t),t){case GSI.ShareDialog.MODE.LINK:this.title.html(GSI.TEXT.SHARE.DIALOG_LINK_TITLE),this._downloadButton.hide(),this._copyButton.show(),this._setMessage(GSI.TEXT.SHARE.DIALOG_LINK_MESSAGE),this._initializeLinkMode();break;case GSI.ShareDialog.MODE.BUILTIN:this.title.html(GSI.TEXT.SHARE.DIALOG_BUILTIN_TITLE),this._downloadButton.hide(),this._copyButton.show(),this._setMessage(GSI.TEXT.SHARE.DIALOG_BUILTIN_MESSAGE),this._initializeBuiltInMode();break;case GSI.ShareDialog.MODE.FILE:this.title.html(GSI.TEXT.SHARE.DIALOG_SAVE_TITLE),GSI.Utils.hasFileAPI?(this._setMessage(GSI.TEXT.SHARE.DIALOG_SAVE_MESSAGE),this._zeroClipboard&&this._zeroClipboard.destroy(),this._zeroClipboard=null,this._copyButton.hide(),this._downloadButton.show()):(this._downloadButton.hide(),this._copyButton.show(),this._setMessage(GSI.TEXT.SHARE.DIALOG_SAVE_MESSAGE_IE8)),this._initializeFileMode()}this._settingFrame.hide(),GSI.Dialog.prototype.show.call(this)},_setCheckdState:function(t,i){t.attr({checked:i}),t.prop({checked:i})},_initializeSetting:function(t){this._setCheckdState(this._positionShareCheck,!0),this._setCheckdState(this._basemapCheck,!0),this._setCheckdState(this._layerpCheck,!0),this._setCheckdState(this._visibleHeaderCheck,t!=GSI.ShareDialog.MODE.BUILTIN),this._setCheckdState(this._visibleInfoMenuCheck,t!=GSI.ShareDialog.MODE.BUILTIN),this._setCheckdState(this._visibleFuncMenuCheck,t!=GSI.ShareDialog.MODE.BUILTIN),this._setCheckdState(this._visibleContextMenuCheck,t!=GSI.ShareDialog.MODE.BUILTIN),this._setCheckdState(this._visibleBaseLayerSelectorCheck,t!=GSI.ShareDialog.MODE.BUILTIN),this._setCheckdState(this._visibleViewListDlgCheck,!1),this._setCheckdState(this._visibleLayerTreeDlgCheck,!1),this._setCheckdState(this._showCurrentFolderCheck,!1),this._setCheckdState(this._centerCrossCheck,this.pageStateManager.getViewSettingVisible(CONFIG.PARAMETERNAMES.CENTERCROSS))},_initializeLinkMode:function(){this._textarea.val(this.getUrl())},_initializeBuiltInMode:function(){var t=this.getUrl(""),i=500,e=400,s='<iframe frameborder="0" scrolling="no" marginheight="0" marginwidth="0" width="'+i+'" height="'+e+'" src="'+t+'"></iframe>';this._textarea.val(s)},_initializeFileMode:function(){var t=GSI.ClientMode.location?GSI.ClientMode.location:location;this._htmlTemplate&&""!=this._htmlTemplate?this._refreshShareFile():this._ajax=$.ajax({type:"GET",dataType:"text",url:t.pathname,success:L.Util.bind(this._onHtmlTemplateLoad,this),error:L.Util.bind(this._onHtmlTemplateLoadError,this)})},_refreshShareFile:function(){var t="",i=this._htmlTemplate;if(this.sakuzuList){var e=this.sakuzuList.getGeoJSONList();t+="GSI.ClientMode.sakuzuList = "+JSON.stringify(e)+";\n"}t+='GSI.ClientMode.queryString = "'+this._makeQueryString()+'";\n',i=i.replace("/*INSERT-SCRIPT*/",t),this._textarea.focus(),this._textarea.val(i)},_onDownLoadClick:function(){var t="gsi"+GSI.Utils.getTimeStampString()+".html",i=new Blob([this._textarea.val()],{type:"text/html"});window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(i,t):(window.URL=window.URL||window.webkitURL,this._downloadButton.attr({download:t,href:window.URL.createObjectURL(i)}))},_onHtmlTemplateLoad:function(t){this._htmlTemplate=t.replace("\r\n","\n"),this._htmlTemplate=this._htmlTemplate.replace("\r","\n");var i=GSI.Utils.getCurrentPath();if("/"!=i.charAt(i.length-1)){var e=i.lastIndexOf("/");i=i.substring(0,e+1)}var s='<base href="'+i+'">';t=t.replace("<!--INSERT-BASE-->",s);var a=this.layersJSON.getOriginal(),n={href:location.href,protocol:location.protocol,path:location.path,pathname:location.pathname,host:location.host,hostname:location.hostname,port:location.port},o="";o+='GSI.ClientMode .baseUrl = "'+i+'";\n',o+="GSI.ClientMode .location = "+JSON.stringify(n)+"\n",o+="GSI.ClientMode .LayerJS = "+JSON.stringify(a).split("</script>").join("<\\/script>")+";\n",t=t.replace("/*INSERT-SCRIPT*/",o+"/*INSERT-SCRIPT*/"),this._htmlTemplate=t,this._refreshShareFile()},_onHtmlTemplateLoadError:function(){alert(GSI.TEXT.SHARE.DIALOG_TEMPLATELOADERROR),this.hide()},_onSettingChange:function(){switch(this._mode){case GSI.ShareDialog.MODE.LINK:this._initializeLinkMode();break;case GSI.ShareDialog.MODE.BUILTIN:this._initializeBuiltInMode();break;case GSI.ShareDialog.MODE.FILE:this._refreshShareFile()}},_makeQueryString:function(t){var i="";if(this._positionShareCheck.is(":checked")&&(i+=(""!=i?"&":"")+this.pageStateManager.getPositionQueryString()),this._basemapCheck.is(":checked")&&(i+=(""!=i?"&":"")+this.pageStateManager.getBaseLayerQueryString()),this._layerpCheck.is(":checked")){var e=this.pageStateManager.getLayersQueryString();""!=e&&(i+=(""!=i?"&":"")+e);var s=this.pageStateManager.getTileViewSetting();""!=s&&(i+=(""!=i?"&":"")+s)}var a=[];this._visibleHeaderCheck.is(":checked")||a.push(CONFIG.HIDDENCONTROLPARAMETER.HEADER),this._visibleInfoMenuCheck.is(":checked")||a.push(CONFIG.HIDDENCONTROLPARAMETER.INFOMENU),this._visibleFuncMenuCheck.is(":checked")||a.push(CONFIG.HIDDENCONTROLPARAMETER.FUNCMENU),this._visibleContextMenuCheck.is(":checked")||a.push(CONFIG.HIDDENCONTROLPARAMETER.CONTEXTMENU),this._visibleBaseLayerSelectorCheck.is(":checked")||a.push(CONFIG.HIDDENCONTROLPARAMETER.BASEMAPSELECTOR);var n={};n[CONFIG.PARAMETERNAMES.CLICKMOVE]=!0,n[CONFIG.PARAMETERNAMES.COCOTILE]=!0;var o={};o[CONFIG.PARAMETERNAMES.CENTERCROSS]=this._centerCrossCheck.is(":checked");var r={};r[CONFIG.DIALOGPARAMETER.VIEWLISTDIALOG]=this._visibleViewListDlgCheck.is(":checked"),r[CONFIG.DIALOGPARAMETER.LAYERTREEDIALOG]=this._visibleLayerTreeDlgCheck.is(":checked");var l=null;this._showCurrentFolderCheck.is(":checked")&&(l=this.pageStateManager.getCurrentPathQueryString(),l&&""!=l&&(i+=(""!=i?"&":"")+l));var h=this.pageStateManager.getQueryParams({hcList:a,vsInfo:{skips:n,visibles:o},visibleDialogs:r});for(var d in h)i+=(""!=i?"&":"")+d+"="+h[d];return t&&""!=t&&(i+=(""!=i?"&":"")+t),i},getUrl:function(t){var i=GSI.Utils.getCurrentPath(),e=this._makeQueryString(t);return""!=e&&(i+="?"+e),i},afterShow:function(){this._initializeCopy()},_initializeCopy:function(){this._zeroClipboard||(this._zeroClipboard=new ZeroClipboard(this._copyButton[0]),this._zeroClipboard.on("ready",L.bind(function(){this._zeroClipboard.on("beforecopy",L.bind(function(){this._zeroClipboard.setText(this._textarea.val()),alert("クリップボードにコピーしました")},this)),this._zeroClipboard.on("aftercopy",L.bind(function(){},this))},this)))},hide:function(){GSI.Dialog.prototype.hide.call(this)},_setMessage:function(t){this._messageFrame.empty();var i=$("<img>").attr({src:"image/system/info.png"});this._messageFrame.append(i).append($("<div>").html(t))},createHeader:function(){return this.title=$("<div>").html(this.options.title),$("<div>").append(this.title)},createContent:function(){return this._frame=$("<div>").addClass("gsi_sharedialog_frame"),this._messageFrame=$("<div>").addClass("messageframe"),this._textareaFrame=$("<div>").addClass("textareaframe"),this._contentFrame=$("<div>"),this._settingFrame=$("<div>").addClass("settingframe"),this._frame.append(this._messageFrame),this._frame.append(this._textareaFrame),this._frame.append(this._contentFrame),this._frame.append(this._settingFrame),this._frame},_createTextareaContent:function(t){if(this._textareaContent)return void(t?this._textareaContent.show():this._textareaContent.hide());var i=$("<div>").addClass("textareacontent"),e=$("<div>");this._textarea=$("<textarea>").attr({rows:4,readonly:"readonly",wrap:"off"}).click(function(){this.select()}),this._textarea.focus(),this._textarea.val(""),e.append(this._textarea),this._downloadButton=$("<a>").attr({href:"javascript:void(0);"}).addClass("normalbutton").css({"float":"right"}).html(GSI.TEXT.SHARE.DIALOG_DOWNLOADBTN).click(L.bind(this._onDownLoadClick,this)),GSI.Utils.canUseFlashPlayer()?this._copyButton=$("<a>").attr({href:"javascript:void(0);"}).addClass("normalbutton").css({"float":"right"}).html(GSI.TEXT.SHARE.DIALOG_COPYBTN):this._copyButton=$("<span>").css({"float":"right"}).html(GSI.TEXT.SHARE.DIALOG_NOCOPYMSG),i.append(e);var s=$("<a>").attr({href:"javascript:void(0);"}).addClass("normalbutton").css({"float":"left"}).html("詳細設定").click(L.bind(function(){this._settingFrame.slideToggle("fast")},this)),a=$("<div>").addClass("buttonframe");a.append(this._copyButton),a.append(this._downloadButton),a.append(s),a.append($("<div>").css({clear:"both"})),i.append(a),this._textareaFrame.append(i),this._textareaContent=i},_createShareBuiltInContent:function(){this._shareBuiltInContent},_createShareFileContent:function(){this._shareFileContent},_createSettingContent:function(){if(!this._settingContent){this._settingContent=$("<div>").addClass("settingcontent"),this._settingContent.append($("<h3>").html("基本設定"));var t=function(t,i){var e=$("<li>"),s="GSI_ShareDialog_check"+GSI.Utils.getCurrentID(),a=$("<input>").attr({type:"checkbox",id:s}).addClass("normalcheck");e.append(a);var n=$("<label>").attr({"for":s});return n.html(i),e.append(n),a.click(L.bind(t._onSettingChange,t)),{li:e,checkbox:a}},i=$("<ul>"),e=null;e=t(this,"表示中の中心位置とズームを共有"),i.append(e.li),this._positionShareCheck=e.checkbox,e=t(this,"表示中の背景地図を共有"),i.append(e.li),this._basemapCheck=e.checkbox,e=t(this,"表示中のレイヤーを共有"),i.append(e.li),this._layerpCheck=e.checkbox,this._settingContent.append(i),this._settingContent.append($("<h3>").html("機能設定")),i=$("<ul>"),e=t(this,"検索とお知らせを表示"),i.append(e.li),this._visibleHeaderCheck=e.checkbox,e=t(this,"情報ボタンを表示"),i.append(e.li),this._visibleInfoMenuCheck=e.checkbox,e=t(this,"機能ボタンを表示"),i.append(e.li),this._visibleFuncMenuCheck=e.checkbox,e=t(this,"コンテキストメニューを表示"),i.append(e.li),this._visibleContextMenuCheck=e.checkbox,e=t(this,"背景地図選択を表示"),i.append(e.li),this._visibleBaseLayerSelectorCheck=e.checkbox,this._settingContent.append(i),this._settingContent.append($("<h3>").html("表示中の情報設定")),i=$("<ul>"),e=t(this,"表示中の情報を開く"),i.append(e.li),this._visibleViewListDlgCheck=e.checkbox,this._settingContent.append(i),this._settingContent.append($("<h3>").html("表示できる情報設定")),i=$("<ul>"),e=t(this,"表示できる情報を開く"),i.append(e.li),this._visibleLayerTreeDlgCheck=e.checkbox,e=t(this,"表示中のフォルダを開いた状態で表示"),i.append(e.li),this._showCurrentFolderCheck=e.checkbox,this._settingContent.append(i),this._settingContent.append($("<h3>").html("表示設定")),i=$("<ul>"),e=t(this,"中心十字線を表示"),i.append(e.li),this._centerCrossCheck=e.checkbox,this._settingContent.append(i),this._settingFrame.append(this._settingContent)}}}),GSI.ShareDialog.MODE={LINK:"link",BUILTIN:"builtin",FILE:"file"},GSI.LayerOpacitySetter=L.Class.extend({opacity:1,getOpacity:function(){return this.opacity},setOpacity:function(t,i){this.opacity=i,this._setLayerOpacity(t)},_setLayerOpacity:function(t){t&&(t.setOpacity?t.setOpacity(this.opacity):t._icon?$(t._icon).css({opacity:this.opacity}):t._container&&$(t._container).css({opacity:this.opacity}),t.eachLayer&&t.eachLayer(L.bind(this._setLayerOpacity,this)))}}),GSI.TileLayer=L.TileLayer.extend({initialize:function(t,i){L.TileLayer.prototype.initialize.call(this,t,i)},_addTile:function(t,i){var e=this._getTilePos(t),s=this._getTile();L.DomUtil.setPosition(s,e,L.Browser.chrome),this._tiles[t.x+":"+t.y]=s,this._loadTile(s,t),s.parentNode!==this._tileContainer&&i.appendChild(s),GSI.Utils.Browser.ie&&GSI.Utils.Browser.version<=8&&void 0!==this.options.opacity&&L.DomUtil.setOpacity(s,this.options.opacity)},_update:function(){if(this._map){var t=this._map,i=t.getPixelBounds(),e=t.getZoom(),s=this._getTileSize();if(e>this.options.maxZoom||e<this.options.minZoom)return void this._reset({hard:!0});var a=L.bounds(i.min.divideBy(s)._floor(),i.max.divideBy(s)._floor());this._addTilesFromCenterOut(a),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(a)}}}),GSI.GeoJSON=L.Class.extend({includes:L.Mixin.Events,opacity:1,opacitySetter:new GSI.LayerOpacitySetter,initialize:function(t,i){this.url=t,i=L.setOptions(this,i)},load:function(){this.fire("loadstart",{src:this});try{this._cerateLayer()}catch(t){return void this.fire("load",{src:this
})}this._loadTimerId=setTimeout(L.bind(this._loadStart,this),200)},_loadStart:function(){this._loadTimerId&&(clearTimeout(this._loadTimerId),this._loadTimerId=null);try{this._load()}catch(t){this.fire("load",{src:this})}},onPointToLayer:function(t,i){if(!t.properties)return L.marker(i);var e=null;if(t.properties._markerType){var s=t.properties._markerType;switch(s){case"DivIcon":var a=t.properties._iconSize,n=t.properties._iconAnchor,o=t.properties._html,r=t.properties._className,l={};a&&(l.iconSize=a),n&&(l.iconAnchor=n),o&&(l.html=o),r&&(l.className=r),e=L.marker(i,{icon:GSI.divIcon(l)});break;case"CircleMarker":case"Circle":var l={};for(var h in t.properties)if(t.properties[h]&&""!=h&&"_"==h.charAt(0)&&"_markerType"!=h){var d=t.properties[h];h=h.slice(1),l[h]=d}e=L.circle(i,l.radius,l)}}if(!e){var c=t.properties._iconUrl,a=t.properties._iconSize,n=t.properties._iconAnchor,r=t.properties._className,p={};c&&(p.iconUrl=c),a&&(p.iconSize=a),n&&(p.iconAnchor=n),r&&(p.className=r),e=L.marker(i,{icon:L.icon(p)})}return e},onStyle:function(t){if(!t.properties)return null;var i=null,e={_markerType:!0,_iconUrl:!0,_iconSize:!0,_iconAnchor:!0,_html:!0,_radius:!0};for(var s in t.properties)if((t.properties[s]||0==t.properties[s])&&""!=s&&"_"==s.charAt(0)){if(e[s])continue;var a=t.properties[s];s=s.slice(1),i||(i={}),i[s]=a}return i},onEachFeature:function(t,i){if(t.properties){var e="";if(t.properties.name&&(e+="<h2>"+GSI.Utils.encodeHTML(t.properties.name)+"</h2>"),t.properties.description)e+=t.properties.description;else{var s="";for(var a in t.properties)t.properties[a]&&(""==a||"name"==a||CONFIG.GEOJSONSPECIALKEYS[a]||(s+="<tr><td>"+a+"</td><td>"+t.properties[a]+"</td></tr>"));""!=s&&(s="<table>"+s+"</table>",e+=s)}""!=e&&i.bindPopup(e,{maxWidth:5e3})}},onLoadError:function(){this.fire("load",{src:this})},setMarkerZIndex:function(t){this.options.zIndexOffset=t,this.layer&&this.layer.setMarkerZIndex&&this.layer.setMarkerZIndex(this.options.zIndexOffset)},addData:function(t){try{this.layer||this._cerateLayer(),"Topology"==t.type?(t=omnivore.topojson.parse(t),this.layer.addData(t)):this.layer.addData(t),this.options.zIndexOffset&&this.layer.setMarkerZIndex&&this.layer.setMarkerZIndex(this.options.zIndexOffset)}catch(i){}},onLoad:function(result){var data=null;if(result){data=result.data?result.data:result;var jsonData=null;try{jsonData=eval("("+data+")")}catch(e){jsonData=data}this.addData(jsonData),this.fire("load",{src:this})}},getBounds:function(){return this.layer?this.layer.getBounds():null},_cerateLayer:function(){var t={};if(t.style=L.bind(this.onStyle,this),t.onEachFeature=L.bind(this.onEachFeature,this),t.pointToLayer=L.bind(this.onPointToLayer,this),this.layer=new L.GeoJSON(null,t),!this._layerAdded&&this._map){var i=this._map.getZoom();if(this.options.minZoom&&this.options.minZoom>i)return;if(this.options.maxZoom&&this.options.maxZoom<i)return;this._map.addLayer(this.layer),this._layerAdded=!0}},_loadFromFile:function(){},_load:function(){if(CONFIG.FORCECORS||GSI.Utils.isLocalUrl(this.url))this.ajax=$.ajax({type:"GET",dataType:"text",url:this.url,success:L.Util.bind(this.onLoad,this),error:L.Util.bind(this.onLoadError,this)});else{var t={url:this.url,lf:0};this.ajax=$.ajax({type:"GET",dataType:"jsonp",data:t,url:CONFIG.SERVERAPI.GETJSONP,success:L.Util.bind(this.onLoad,this),error:L.Util.bind(this.onLoadError,this)})}},_onZoomChange:function(){if(this.layer){var t=this._map.getZoom();this.options.minZoom&&this.options.minZoom>t||this.options.maxZoom&&this.options.maxZoom<t?(this._layerAdded=!1,this._map.removeLayer(this.layer)):this._layerAdded||(this._layerAdded=!0,this._map.addLayer(this.layer))}},onAdd:function(t){if(this._map=t,this._map.on("zoomend",this._onZoomChange,this),this.layer){var i=this._map.getZoom();if(this.options.minZoom&&this.options.minZoom>i)return;if(this.options.maxZoom&&this.options.maxZoom<i)return;this._layerAdded=!0,t.addLayer(this.layer)}},onRemove:function(t){t&&t.off("zoomend",this._onZoomChange,this),this.layer&&(t.removeLayer(this.layer),this._layerAdded=!1),this._map=null},setOpacity:function(t){this.opacity=t,this.opacitySetter.setOpacity(this.layer,t)},getLayers:function(){return this.layer?this.layer.getLayers():null},addLayer:function(t){this.layer&&this.layer.addLayer(t)},removeLayer:function(t){this.layer&&this.layer.removeLayer(t)}}),GSI.GeoJSONTileLayer=L.TileLayer.GeoJSON.extend({_opacity:1,initialize:function(t,i,e){i.clipTiles=!1,L.TileLayer.GeoJSON.prototype.initialize.call(this,t,i,e),this._loadStyle(t)},setMarkerZIndex:function(t){this.options.zIndexOffset=t,this.geojsonLayer&&this.geojsonLayer.setMarkerZIndex&&this.geojsonLayer.setMarkerZIndex(this.options.zIndexOffset)},_tileLoaded:function(t,i){return t&&t.datum&&this.options.isTopoJSON&&(t.datum=omnivore.topojson.parse(t.datum)),L.TileLayer.Ajax.prototype._tileLoaded.apply(this,arguments),null===t.datum?null:(this.addTileData(t.datum,i),1!=this._opacity&&this.setOpacity(this._opacity),void(this.geojsonLayer&&this.options.zIndexOffset&&this.geojsonLayer.setMarkerZIndex&&this.geojsonLayer.setMarkerZIndex(this.options.zIndexOffset)))},_onStyleLoad:function(result){try{var data=null;if(!result)return;data=result.data?result.data:result,data=eval("("+data+")"),data.geojsonOptions&&(this.geojsonLayer.options=data.geojsonOptions),data.options&&(this.options._minZoom&&(data.options.minZoom=this.options._minZoom),this.options._maxZoom&&(data.options.maxZoom=this.options._maxZoom),this.options._maxNativeZoom&&(data.options.maxNativeZoom=this.options._maxNativeZoom),this.options._attribution&&(data.options.attribution=this.options._attribution),L.setOptions(this,data.options))}catch(e){}this._tileContainer&&this._reset(),this._update()},_loadStyle:function(t){var i=t.replace(/\/\{z\}.*/,"")+"/style.js";if(CONFIG.FORCECORS||GSI.Utils.isLocalUrl(t))this._styleAjax=$.ajax({type:"GET",dataType:"text",url:i,success:L.Util.bind(this._onStyleLoad,this),async:!0});else{var e={url:i,lf:0};this._styleAjax=$.ajax({type:"GET",dataType:"jsonp",data:e,url:CONFIG.SERVERAPI.GETJSONP,success:L.Util.bind(this._onStyleLoad,this),async:!0})}},setOpacity:function(t){if(this._opacity=t,this.geojsonLayer){var i=new GSI.LayerOpacitySetter;i.setOpacity(this.geojsonLayer,t)}}}),GSI.MapLayerList=L.Class.extend({includes:L.Mixin.Events,tileList:[],list:[],initialize:function(t,i){this.map=t,i=L.setOptions(this,i)},appendKML:function(t){this.exists(t)||(this.map.addLayer(t._visibleInfo.layer,!0),this.list.unshift(t),this._initZIndex(this.list))},appendList:function(t,i){for(var e=0;e<t.length;e++)this.append(t[e],!0,i)},append:function(t,i,e){if(!this.exists(t)){if(t._visibleInfo={},t._visibleInfo.opacity=t.initialOpacity?t.initialOpacity:1,t.initialOpacity=null,"tile"==t.layerType){var s={errorTileUrl:""};t.subdomains&&""!=t.subdomains&&(s.subdomains=t.subdomains),0!=t.minZoom&&!t.minZoom||""==t.minZoom||(s.minZoom=t.minZoom),0!=t.maxZoom&&!t.maxZoom||""==t.maxZoom||(s.maxZoom=t.maxZoom),t.maxNativeZoom&&""!=t.maxNativeZoom&&(s.maxNativeZoom=t.maxNativeZoom),t.attribution&&(s.attribution=t.attribution),t._visibleInfo.layer=new GSI.TileLayer(t.url,s),e?t._visibleInfo._isHidden=!0:this.map.addLayer(t._visibleInfo.layer,!0),this.tileList.unshift(t),this._initZIndex(this.tileList)}else if("kml"==t.layerType){var s={async:!0,_map:this.map};0!=t.minZoom&&!t.minZoom||""==t.minZoom||(s.minZoom=t.minZoom),0!=t.maxZoom&&!t.maxZoom||""==t.maxZoom||(s.maxZoom=t.maxZoom),t.attribution&&(s.attribution=t.attribution),t._visibleInfo.layer=new GSI.KML(t.url,s),t._visibleInfo.layer._noFinishMove=i,t._visibleInfo.layer.on("loadstart",L.bind(this.onLayerLoadStart,this,t._visibleInfo.layer,"KML")),t._visibleInfo.layer.on("loaded",L.bind(this.onLayerLoad,this,t._visibleInfo.layer)),t._visibleInfo.layer.load(),e?t._visibleInfo._isHidden=!0:this.map.addLayer(t._visibleInfo.layer,!0),this.list.unshift(t),this._initZIndexOffset(this.list,1e4)}else if("geojson"==t.layerType){var s={};0!=t.minZoom&&!t.minZoom||""==t.minZoom||(s.minZoom=t.minZoom),0!=t.maxZoom&&!t.maxZoom||""==t.maxZoom||(s.maxZoom=t.maxZoom),t.attribution&&(s.attribution=t.attribution),t._visibleInfo.layer=new GSI.GeoJSON(t.url,s),t._visibleInfo.layer._noFinishMove=i,t._visibleInfo.layer.on("loadstart",L.bind(this.onLayerLoadStart,this,t._visibleInfo.layer,"GeoJSON")),t._visibleInfo.layer.on("load",L.bind(function(t){this.onLayerLoad(t.src)},this)),t._visibleInfo.layer.load(),e?t._visibleInfo._isHidden=!0:this.map.addLayer(t._visibleInfo.layer),this.list.unshift(t),this._initZIndexOffset(this.list,1e4)}else if("geojson_tile"==t.layerType){var s={clipTiles:!0},a={};t.subdomains&&""!=t.subdomains&&(s.subdomains=t.subdomains),0!=t.minZoom&&!t.minZoom||""==t.minZoom||(s.minZoom=t.minZoom,s._minZoom=t.minZoom),0!=t.maxZoom&&!t.maxZoom||""==t.maxZoom||(s.maxZoom=t.maxZoom,s._maxZoom=t.maxZoom),t.maxNativeZoom&&""!=t.maxNativeZoom&&(s.maxNativeZoom=t.maxNativeZoom,s._maxNativeZoom=t.maxNativeZoom),t.attribution&&(s.attribution=t.attribution,s._attribution=t.attribution),t._visibleInfo.layer=new GSI.GeoJSONTileLayer(t.url,s,a),e?t._visibleInfo._isHidden=!0:this.map.addLayer(t._visibleInfo.layer,!0),this.list.unshift(t),this._initZIndexOffset(this.list,1e4)}else if("topojson_tile"==t.layerType){var s={clipTiles:!0,isTopoJSON:!0},a={};t.subdomains&&""!=t.subdomains&&(s.subdomains=t.subdomains),0!=t.minZoom&&!t.minZoom||""==t.minZoom||(s.minZoom=t.minZoom,s._minZoom=t.minZoom),0!=t.maxZoom&&!t.maxZoom||""==t.maxZoom||(s.maxZoom=t.maxZoom,s._maxZoom=t.maxZoom),t.maxNativeZoom&&""!=t.maxNativeZoom&&(s.maxNativeZoom=t.maxNativeZoom,s._maxNativeZoom=t.maxNativeZoom),t.attribution&&(s.attribution=t.attribution,s._attribution=t.attribution),t._visibleInfo.layer=new GSI.GeoJSONTileLayer(t.url,s,a),e?t._visibleInfo._isHidden=!0:this.map.addLayer(t._visibleInfo.layer,!0),this.list.unshift(t),this._initZIndexOffset(this.list,1e4)}else if("topojson"==t.layerType){var s={layerType:"topojson"};0!=t.minZoom&&!t.minZoom||""==t.minZoom||(s.minZoom=t.minZoom),0!=t.maxZoom&&!t.maxZoom||""==t.maxZoom||(s.maxZoom=t.maxZoom),t.attribution&&(s.attribution=t.attribution),t._visibleInfo.layer=new GSI.GeoJSON(t.url,s),t._visibleInfo.layer._noFinishMove=i,t._visibleInfo.layer.on("loadstart",L.bind(this.onLayerLoadStart,this,t._visibleInfo.layer,"TopoJSON")),t._visibleInfo.layer.on("load",L.bind(function(t){this.onLayerLoad(t.src)},this)),t._visibleInfo.layer.load(),e?t._visibleInfo._isHidden=!0:this.map.addLayer(t._visibleInfo.layer),this.list.unshift(t),this._initZIndexOffset(this.list,1e4)}else if("tms"==t.layerType){var s={};0!=t.minZoom&&!t.minZoom||""==t.minZoom||(s.minZoom=t.minZoom),0!=t.maxZoom&&!t.maxZoom||""==t.maxZoom||(s.maxZoom=t.maxZoom),t.maxNativeZoom&&""!=t.maxNativeZoom&&(s.maxNativeZoom=t.maxNativeZoom),t.attribution&&(s.attribution=t.attribution),t._visibleInfo.layer=new GSI.GSITMSLayer(t.url,s),e?t._visibleInfo._isHidden=!0:this.map.addLayer(t._visibleInfo.layer,!0),this.tileList.unshift(t),this._initZIndex(this.tileList)}if(t._visibleInfo.layer)if(t._visibleInfo.layer.setOpacity)t._visibleInfo.layer.setOpacity(t._visibleInfo.opacity);else{var n=new GSI.LayerOpacitySetter;n.setOpacity(t._visibleInfo.layer,t._visibleInfo.opacity)}this.fire("change")}},_showLoading:function(t){this._showLoadingInc&&0!=this._showLoadingInc||(this._showLoadingInc=0),this._showLoadingInc++},_hideLoading:function(){this._showLoadingInc--},onLayerLoadStart:function(t,i){this._showLoading(i)},onLayerLoad:function(t){if(!t._noFinishMove&&t.getBounds)try{this.map.fitBounds(t.getBounds())}catch(i){}this._hideLoading()},_initZIndexOffset:function(t,i){for(var e=0,s=t.length-1;s>=0;s--){var a=t[s];a._visibleInfo.layer&&a._visibleInfo.layer.setMarkerZIndex&&(a._visibleInfo.layer.setMarkerZIndex(e),e+=i)}},_initZIndex:function(t){for(var i=100,e=t.length-1;e>=0;e--){var s=t[e];s._visibleInfo.layer&&s._visibleInfo.layer.setZIndex&&(s._visibleInfo.layer.setZIndex(i),i++)}},refreshTileList:function(t){this.tileList=t,this._initZIndex(this.tileList)},exists:function(t){if(CONFIG.LAYERTYPELIST[t.layerType].isTileImage){for(var i=0;i<this.tileList.length;i++)if(this.tileList[i]==t)return!0}else for(var i=0;i<this.list.length;i++)if(this.list[i]==t)return!0;return!1},remove:function(t){if(CONFIG.LAYERTYPELIST[t.layerType].isTileImage){for(var i=0;i<this.tileList.length;i++)if(this.tileList[i]==t){this.tileList.splice(i,1);break}}else for(var i=0;i<this.list.length;i++)if(this.list[i]==t){this.list.splice(i,1);break}this.map.removeLayer(t._visibleInfo.layer),t._visibleInfo=null,this.fire("change")},clear:function(){for(var t=0;t<this.list.length;t++){var i=this.list[t];this.map.removeLayer(i._visibleInfo.layer),i._visibleInfo=null}this.list=[];for(var t=0;t<this.tileList.length;t++){var i=this.tileList[t];this.map.removeLayer(i._visibleInfo.layer),i._visibleInfo=null}this.tileList=[],this.fire("change")},getTileList:function(){return this.tileList},getList:function(){return this.list}}),GSI.CenterCrossMarker=L.Marker.extend({_initIcon:function(){var t=this.options,i=this._map,e=i.options.zoomAnimation&&i.options.markerZoomAnimation,s=e?"leaflet-zoom-animated":"leaflet-zoom-hide",a=t.icon.createIcon(this._icon),n=!1;a!==this._icon&&(this._icon&&this._removeIcon(),n=!0,t.title&&(a.title=t.title),t.alt&&(a.alt=t.alt)),L.DomUtil.addClass(a,s),t.keyboard&&(a.tabIndex="0"),this._icon=a,this._initInteraction(),t.riseOnHover&&L.DomEvent.on(a,"mouseover",this._bringToFront,this).on(a,"mouseout",this._resetZIndex,this);var o=t.icon.createShadow(this._shadow),r=!1;o!==this._shadow&&(this._removeShadow(),r=!0),o&&L.DomUtil.addClass(o,s),this._shadow=o,t.opacity<1&&this._updateOpacity();var l=this._map._panes;n&&l.gsiObjectsPane.appendChild(this._icon),o&&r&&l.objectsPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&L.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.gsiObjectsPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.objectsPane.removeChild(this._shadow),this._shadow=null}}),GSI.CenterCross=L.Class.extend({marker:null,options:{visible:!0},initialize:function(t,i){i=L.setOptions(this,i),this.map=t,this._refresh=L.bind(this.refresh,this),this.setVisible(this.options.visible)},refresh:function(){if(this.options.visible){var t=this.map.getCenter();if(this.marker)this.marker.setLatLng(t);else{var i=L.icon({iconUrl:"image/map/crosshairs.png",iconSize:[32,32],iconAnchor:[16,16]});this.marker=new GSI.CenterCrossMarker(t,{icon:i,clickable:!1,draggable:!1,keyboard:!1,opacity:.8,zIndexOffset:0}),this.marker.addTo(this.map)}}else this.marker&&(this.map.removeLayer(this.marker),this.marker=null)},setVisible:function(t){this.options.visible=t,this.options.visible?this.map.on("move",this._refresh):this.map.off("move",this._refresh),this.refresh()},getVisible:function(){return this.options.visible}}),GSI.BaseLayer=L.TileLayer.extend({baseLayerList:null,activeIndex:0,isGrayScale:!1,opacity:1,highQuality:!1,initialize:function(t,i,e){if(this.activeIndex=0,i)for(var s=0;s<t.length;s++)if(t[s].id==i){this.activeIndex=s;break}this.baseLayerList=t,e=L.setOptions(this,e),e.minZoom=2,this.setActiveIndex(this.activeIndex)},setHighQuality:function(t){this.highQuality=t,this.highQuality&&this._map&&this._map.getZoom()<18?this.options.tileSize=128:this.options.tileSize=256,this.redraw()},getHighQuality:function(){return this.highQuality},_getZoomForUrl:function(){var t=this.options,i=this._map.getZoom();return this.highQuality&&(i++,i>18?(i=18,this.options.tileSize=256):this.options.tileSize=128),t.zoomReverse&&(i=t.maxZoom-i),i+=t.zoomOffset,t.maxNativeZoom?Math.min(i,t.maxNativeZoom):i},getActiveId:function(){return this.baseLayerList[this.activeIndex].id},getActiveIndex:function(){return this.activeIndex},setActiveIndex:function(t){this.activeIndex=t,this._url=this.baseLayerList[t].url,this.baseLayerList[t].subdomains&&(this.options.subdomains=this.baseLayerList[t].subdomains),this.options.maxNativeZoom=this.baseLayerList[t].maxNativeZoom,this.options.errorTileUrl=this.baseLayerList[t].errorTileUrl,this.baseLayerList[t].minZoom&&(this.options.minZoom=this.baseLayerList[t].minZoom),this.setUrl(this._url)},_createTile:function(){var t=L.TileLayer.prototype._createTile.call(this);return t},_tileOnLoad:function(){var t=this._layer;t.isGrayScale&&this.src!==L.Util.emptyImageUrl&&($(this).addClass("grayscale"),GSI.Utils.Browser.ie&&(GSI.Utils.Browser.version>=10?$(this).data("_src")||($(this).data({_src:this.src}),this.src=this._layer.grayscaleIE1011(this)):$(this).css({filter:"gray",opacity:this._layer.opacity}))),L.TileLayer.prototype._tileOnLoad.call(this)},_createTile:function(){var t=L.TileLayer.prototype._createTile.call(this);return this.isGrayScale&&(GSI.Utils.Browser.ie&&GSI.Utils.Browser.version>=10&&$(t).attr({crossOrigin:"Anonymous"}),$(t).addClass("grayscale"),GSI.Utils.Browser.ie&&GSI.Utils.Browser.version<10&&$(t).css({filter:"gray",opacity:this.opacity})),t},_resetTile:function(t){$(t).data({_src:null})},setOpacity:function(t){this.opacity=t,L.TileLayer.prototype.setOpacity.call(this,t)},getOpacity:function(t){return this.opacity},grayscaleIE1011:function(t){var i=this._getTileSize(),e=document.createElement("canvas"),s=e.getContext("2d");e.width=i,e.height=i,s.drawImage(t,0,0);for(var a=s.getImageData(0,0,e.width,e.height),n=0;n<a.height;n++)for(var o=0;o<a.width;o++){var r=4*n*a.width+4*o,l=(a.data[r]+a.data[r+1]+a.data[r+2])/3;a.data[r]=l,a.data[r+1]=l,a.data[r+2]=l}return s.putImageData(a,0,0,0,0,a.width,a.height),e.toDataURL()},getGrayScale:function(){return this.isGrayScale},setGrayScale:function(t){this.isGrayScale!=t&&(this.isGrayScale=t,this.redraw())}}),GSI.GSITMSLayer=L.TileLayer.extend({initialize:function(t,i){var e=t.split("{tms}");this._url=e[0],this._ext=e[1],L.setOptions(this,i)},_zeroPad:function(t,i){for(var e=""+t;e.length<i;)e="0"+e;return e},getTileUrl:function(t){for(var i=t.z,e=this._zeroPad(t.x,7),s=this._zeroPad(t.y,7),a="",n=0;6>n;n++){var o=e.substr(n,1),r=s.substr(n,1);a+="/"+o+r}var l=L.Util.template(this._url,{s:this._getSubdomain(t)});return l+i+a+"/"+e+s+this._ext}}),GSI.LayersJSON=L.Class.extend({includes:L.Mixin.Events,ajax:null,layers:[],visibleLayers:[],visibleLayersHash:{},currentFileIndex:-1,options:{files:["layers.txt"]},initialize:function(t){if(t=L.setOptions(this,t),t.layers){this.options.layers=$.extend(!0,[],t.layers),this._loadingData=[];for(var i=0;i<this.options.layers.length;i++)this._loadingData.push({url:this.options.layers[i],layers:[]})}this.options.visibleLayers||(this.options.visibleLayers=[]);for(var i=0;i<this.options.visibleLayers.length;i++){var e=this.options.visibleLayers[i],s={id:e.id,idx:this.visibleLayers.length,initialOpacity:e.opacity,hidden:e.hidden};this.visibleLayers.push(s),this.visibleLayersHash[e.id]=s}},setHasTileList:function(t){this.hasTileList=t,this.refreshHasState()},refreshHasState:function(){if(this.hasTileList&&this.layers)for(var t=0;t<this.layers.length;t++){var i=this.layers[t];i.hasTile=1==this.hasTileList[i._cocotileId]||!i.cocotile}},load:function(){if(this.ajax){try{this.ajax.abort()}catch(t){}this.ajax=null}"file:"==location.protocol||this.options.layersJSON?this.options.layersJSON?this._timerId=setTimeout(L.bind(function(){clearTimeout(this._timerId),this._timerId=null,this._data=this.options.layersJSON,this.layers=[],this._initializeData(this._data,null),this.fire("load",{tree:this.tree,visibleLayers:this.visibleLayers})},this),0):(alert("layers.txtファイルを読み込めません"),this._timerId=setTimeout(L.bind(function(){clearTimeout(this._timerId),this._timerId=null,this.layers=[],this.fire("load",{tree:this.tree,visibleLayers:this.visibleLayers})},this),0)):this._loadingData?(this.currentFileIndex=-1,this._loadNext()):this.ajax=$.ajax({type:"GET",url:"layers.txt",dataType:"text",cache:!1,success:L.bind(this._onLoad,this),error:L.bind(this._onLoadError,this)})},_loadNext:function(){if(this.currentFileIndex++,this.currentFileIndex>=this._loadingData.length){this._data=[];for(var t=0;t<this._loadingData.length;t++)for(var i=0;i<this._loadingData[t].layers.length;i++)this._data.push(this._loadingData[t].layers[i]);return this._loadingData=null,this._original=$.extend(!0,[],this._data),this.layers=[],this._initializeData(this._data,null),void this.fire("load",{tree:this.tree,visibleLayers:this.visibleLayers})}var e=this._loadingData[this.currentFileIndex].url;this.ajax=$.ajax({type:"GET",url:e,dataType:"text",cache:!1,success:L.bind(this._onLoad,this),error:L.bind(this._onLoadError,this)})},_onLoad:function(t){var i=JSON.parse(t);return this._loadingData?(this._loadingData[this.currentFileIndex].layers=i.layers,void this._loadNext()):void(i.layers?(this._data=i.layers,this._original=$.extend(!0,[],this._data),this.layers=[],this._initializeData(this._data,null),this.fire("load",{tree:this.tree,visibleLayers:this.visibleLayers})):this._onLoadError())},getOriginal:function(){return this._original},_onFileLoad:function(t){this._data=JSON.parse(t.text),this._original=$.extend(!0,[],this._data),this.layers=[],this._initializeData(this._data,null),this.fire("load",{tree:this._data,visibleLayers:this.visibleLayers})},_initializeData:function(t,i){t&&(this._initializeTree(t,i),this.tree=t)},_url2LayerType:function(t){if(!t)return"";if(t=$.trim(t),t.match(/\{tms\}/))return"tms";if(t.match(/photoprot\.php/))return"kml";var i="",e="",s=t.match(/.*\.([^.]+$)/);if(s&&(i=s[1]),"kml"==i)return e="kml";if(t.match(/(\{x\})/))switch(i){case"geojson":e="geojson_tile";break;case"topojson":e="topojson_tile";break;default:e="tile"}else switch(i){case"geojson":case"topojson":case"kml":e=i}return e},_getFolderId:function(t){this._currentFolderIdList||(this._currentFolderIdList={}),this._currentFolderIdList[""+t]||(this._currentFolderIdList[""+t]=1);var i=this._currentFolderIdList[""+t];return this._currentFolderIdList[""+t]++,i},_initializeTree:function(t,i){if(t)for(var e=0,s=0;s<t.length;s++){if("Layer"==t[s].type){var a=t[s];if(a.layerType=this._url2LayerType(a.url),a._cocotileId="",a.cocotile){var n=a.url.match(/\/xyz\/(..*?)\/(?={)/);n&&(a._cocotileId=n[1],this.hasTileList&&(a.hasTile=1==this.hasTileList[a._cocotileId]))}if(this.visibleLayersHash[a.id]){var o=this.visibleLayersHash[a.id];a.initialOpacity=o.initialOpacity,this.visibleLayersHash[a.id].info=a}this.layers.push(a)}else t[s].id||(t[s].id=i?i.id+"_"+e:"f"+e,e++);t[s].parent=i,this._initializeTree(t[s].entries,t[s])}},_onLoadError:function(){this._loadingData?this._loadNext():alert("レイヤー設定ファイルが読み込めませんでした。")},_onFileLoadErrorRetry:function(){this.reader=new FileReader,this.reader.onload=L.bind(this._onFileLoad,this),this.reader.onerror=L.bind(this._onLoadErrorExit,this),this.reader.readAsText("./layer.txt")},_onLoadErrorExit:function(){}}),GSI.COCOTileLayer=L.Class.extend({includes:L.Mixin.Events,visible:!0,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",zoomOffset:0,refreshInterval:1e3,unloadInvisibleTiles:L.Browser.mobile,updateWhenIdle:L.Browser.mobile},initialize:function(t,i,e){this.map=t,e=L.setOptions(this,e),this.visible=e.visible,e.detectRetina&&L.Browser.retina&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomOffset++,e.minZoom>0&&e.minZoom--,this.options.maxZoom--),e.bounds&&(e.bounds=L.latLngBounds(e.bounds)),this._url=i;var s=this.options.subdomains;"string"==typeof s&&(this.options.subdomains=s.split("")),e.visible&&this.addTo(this.map)},onAdd:function(t){this._map=t,this._reset(),this._update(),t.on({viewreset:this._reset,moveend:this._moveend,movestart:this._movestart},this)},addTo:function(t){return this.visible=!0,t.addLayer(this),this},getVisible:function(){return this.visible},setVisible:function(t){t?this.addTo(this.map):this._map&&(this.visible=!1,this.map.removeLayer(this),this.fire("hide",null))},refresh:function(){this.visible&&(this._reset(),this._update())},onRemove:function(t){t.off({viewreset:this._reset,moveend:this._update,movestart:this._movestart},this),this._map=null},_reset:function(t){if(this._tiles)for(var i in this._tiles){var e=this._tiles[i];e.ajax&&(e.ajax.abort(),e.ajax=null)}this.refreshTimerId&&(clearTimeout(this.refreshTimerId),this.refreshTimerId=null),this._haveTiles={},this._tiles={},this._tilesToLoad=0},_moveend:function(){this._map&&(this.refreshTimerId=setTimeout(L.Util.bind(this._timerRefresh,this),this.options.refreshInterval))},_movestart:function(){this._reset()},_timerRefresh:function(){this._update()},_update:function(){if(this.refreshTimerId&&(clearTimeout(this.refreshTimerId),this.refreshTimerId=null),this._map){var t=(this._map,this.map.getPixelBounds()),i=this.map.getZoom(),e=this._getTileSize();if(!(i>this.options.maxZoom||i<this.options.minZoom)){var s=L.bounds(t.min.divideBy(e)._floor(),t.max.divideBy(e)._floor());this._addTilesFromCenterOut(s)}}},_getTileSize:function(){var t=(this._map,this.map.getZoom()+this.options.zoomOffset),i=this.options.maxNativeZoom,e=this.options.tileSize;return i&&t>i&&(e=Math.round(this.map.getZoomScale(t)/this.map.getZoomScale(i)*e)),e},_tileShouldBeLoaded:function(t){if(t.x+":"+t.y in this._tiles)return!1;var i=this.options;if(!i.continuousWorld){var e=this._getWrapTileNum();if(i.noWrap&&(t.x<0||t.x>=e.x)||t.y<0||t.y>=e.y)return!1}if(i.bounds){var s=i.tileSize,a=t.multiplyBy(s),n=a.add([s,s]),o=this._map.unproject(a),r=this._map.unproject(n);if(i.continuousWorld||i.noWrap||(o=o.wrap(),r=r.wrap()),!i.bounds.intersects([o,r]))return!1}return!0},_addTilesFromCenterOut:function(t){var i,e,s,a=[],n=t.getCenter();for(i=t.min.y;i<=t.max.y;i++)for(e=t.min.x;e<=t.max.x;e++)s=new L.Point(e,i),this._tileShouldBeLoaded(s)&&a.push(s);var o=a.length;if(0!==o){for(a.sort(function(t,i){return t.distanceTo(n)-i.distanceTo(n)}),this._tilesToLoad+=o,e=0;o>e;e++)this._addTile(a[e]);this.fire("loadstart",null)}},_getTilePos:function(t){var i=this._map.getPixelOrigin(),e=this._getTileSize();return t.multiplyBy(e).subtract(i)},_addTile:function(t){var i=(this._getTilePos(t),{});this._tiles[t.x+":"+t.y]=i,this._loadTile(i,t)},_resetTile:function(){},_adjustTilePoint:function(t){var i=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(t.x=(t.x%i.x+i.x)%i.x),this.options.tms&&(t.y=i.y-t.y-1),t.z=this._getZoomForUrl()},_getZoomForUrl:function(){var t=this.options,i=this._map.getZoom();return t.zoomReverse&&(i=t.maxZoom-i),i+=t.zoomOffset,t.maxNativeZoom?Math.min(i,t.maxNativeZoom):i},_getWrapTileNum:function(){var t=this._map.options.crs,i=t.getSize(this._map.getZoom());return i.divideBy(this._getTileSize())._floor()},getTileUrl:function(t){return L.Util.template(this._url,L.extend({s:this._getSubdomain(t),z:t.z,x:t.x,y:t.y},this.options))},_getSubdomain:function(t){var i=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[i]},_loadTile:function(t,i){this._adjustTilePoint(i),t.src=this.getTileUrl(i),t.ajax=$.ajax({url:t.src,cache:!1,crossDomain:!0,success:L.Util.bind(this._tileLoaded,this,t),error:function(t){}})},_tileLoaded:function(t){if(t.ajax){var i=t.ajax.responseText.split("\n");if(i.length>0)for(var e=i[0],s=e.split(","),a=0;a<s.length;a++){var n=s[a];this._haveTiles[n]=!0}t.ajax=null}t.loaded=!0;for(var o in this._tiles){var t=this._tiles[o];if(t.ajax||!t.loaded)return}this.options.onLoad&&this.options.onLoad(this._haveTiles),this.fire("load",{tileIds:this._haveTiles})}}),GSI.Links={},GSI.Links.getURL=function(t,i,e){if("gsi3d"==t){if(GSI.Utils.Browser.ie&&GSI.Utils.Browser.version<=10)return alert("お使いのWebブラウザは地理院地図3Dに対応していません。\nChrome、Firefox、IE11　をご使用ください。"),null;e>=15&&(e=14);var t=GSI.GLOBALS.baseLayer.activeIndex,s=GSI.GLOBALS.baseLayer.baseLayerList[t].id,a=GSI.GLOBALS.mapLayerList.tileList;if(a.length>0)for(var n=0;n<a.length;n++)if("yk74"==a[n].id){s="gazo1";break}return"std"!=s&&"ort"!=s&&"gazo1"!=s&&(s="std"),"http://cyberjapandata.gsi.go.jp/3d/site/index.html?did="+s+"&z="+e+"&lat="+i.lat+"&lon="+i.lng}if("mapion"==t){var o=e;return 6>=e&&(o=6),"http://www.mapion.co.jp/m2/"+i.lat+","+i.lng+","+o}if("itsumonavi"==t){var o=18,r=GSI.Utils.world2Japan(i),l=Math.round(3600*r.y*1e3),h=Math.round(3600*r.x*1e3);return o=5>=e?1:6>=e?2:7>=e?3:8>=e?4:9>=e?6:10>=e?7:11>=e?8:12>=e?9:13>=e?10:14>=e?11:15>=e?13:16>=e?14:17>=e?16:18,"http://www.its-mo.com/z-"+l+"-"+h+"-"+o+".htm"}return t},GSI.BaseLayerSelector=L.Class.extend({includes:L.Mixin.Events,initialize:function(t,i,e,s){this.map=t,this.baseLayer=i,this.tiles=e,s=L.setOptions(this,s)},show:function(t){this._create(t),this._container.fadeIn("fast")},hide:function(){this._container&&this._container.fadeOut("fast",L.bind(function(){this._container.remove(),delete this._container,this._container=null},this))},_create:function(t){if(!this._container){this._container=$("<div>").addClass("leaflet-buttons-control-baselayerselector").css({"z-index":1e4,position:"absolute",left:"10px",bottom:t+"px"}).hide();for(var i=$("<table>"),e=$("<tbody>"),s=$("<tr>"),a=0;a<this.tiles.length;a++){var n="";a==this.baseLayer.getActiveIndex()&&(n="active");var o=$("<td>").css({"text-align":"center"}).addClass(n),r=$("<div>"),l=$("<a>").attr({title:this.tiles[a].title,href:"javascript:void(0);",tileindex:a}),h=$("<img>").css({width:"60px",height:"60px"}).attr({src:this.tiles[a].icon});r.css({position:"relative"}),l.append(h),r.append(l),o.append(r),s.append(o),l.click(L.bind(function(t){this.fire("click",{activeIndex:t.attr("tileindex")})},this,l))}e.append(s),i.append(e),this._container.append(i);var d=$("<div>").addClass("control");if(i=$("<table>"),e=$("<tbody>"),!GSI.Utils.Browser.ie&&!GSI.Utils.Browser.isAndroid||GSI.Utils.Browser.ie&&(GSI.Utils.Browser.version<10||CONFIG.USEIE10GRAYSCALE&&10==GSI.Utils.Browser.version||CONFIG.USEIE11GRAYSCALE&&GSI.Utils.Browser.version>=11)){s=$("<tr>");var o=$('<td colspan="2">'),c=$("<table>"),p=$("<tbody>"),u=$("<tr>"),m=$("<td>"),f=new GSI.OnOffSwitch({className:"onoff",checked:this.baseLayer.getGrayScale()}),_=$('<label for="'+f.getId()+'"></label>').html("grayscale");m.append(_),u.append(m),m=$("<td>").css({"padding-left":"8px"}),m.append(f.getElement()),u.append(m),f.on("change",L.bind(function(t){this.baseLayer.setGrayScale(t.checked())},this,f)),p.append(u),c.append(p),o.append(c),s.append(o),e.append(s)}i.append(e),d.append(i),this._container.append(d),$(document.body).append(this._container)}}}),GSI.Control.BaseLayerSelector=L.Control.extend({options:{visible:!0,position:"topleft",iconUrl:null,onClick:function(){},hideText:!1,maxWidth:30,doToggle:!0,toggleStatus:!1},tiles:[],activeIndex:0,initialize:function(t,i,e){this.baseLayer=new GSI.BaseLayer(CONFIG.BASETILES,e.defaultMap,{errorTileUrl:"image/map/no-data.png",attribution:"<a href='http://portal.cyberjapan.jp/help/termsofuse.html' target='_blank'>国土地理院</a>"}),this.baseLayer.addTo(t),e=L.setOptions(this,e),this._button={},e.visible&&(t.on("mousedown",L.bind(this.onMapClick,this)),t.on("touchstart",L.bind(this.onMapClick,this)),this.tiles=i,this.options.position=e.position,this.setButton(e))},getBaseLayer:function(){return this.baseLayer},onMapClick:function(){this._selector&&this._selector.hide(),$(this._container).fadeIn("fast")},onAdd:function(t){this._map=t;var i=$("<div>").css({marin:0,padding:0}).addClass("leaflet-control-baselayerselector");return this._container=i[0],this.options.visible||(this._container.style.display="none"),this._update(),this._container},onRemove:function(t){},setButton:function(t){var i={text:t.text,iconUrl:t.iconUrl,onClick:t.onClick,hideText:!!t.hideText,maxWidth:t.maxWidth||70,doToggle:!0,toggleStatus:!1};this._button=i,this._update()},destroy:function(){this._button={},this._update()},toggle:function(t){this.options.visible&&("boolean"==typeof t?this._button.toggleStatus=t:this._button.toggleStatus=!this._button.toggleStatus,this._update())},_update:function(){this._map&&this.options.visible&&(this._container&&$(this._container).empty(),this._makeButton(this._button));
},_makeButton:function(t,i){var e=$("<div>").addClass("leaflet-buttons-control-baselayerselector");$(this._container).append(e);var s,s=$("<img>").css({width:"34px",height:"34px"}).attr({src:this.tiles[this.baseLayer.getActiveIndex()].icon});return e.append(s),L.DomEvent.addListener(e[0],"click",L.DomEvent.stop).addListener(e[0],"click",this._clicked,this),L.DomEvent.disableClickPropagation(e[0]),e},_clicked2:function(t){this.this_.baseLayer.getActiveIndex()!=this.target_.getAttribute("tileindex")&&this.this_.baseLayer.setActiveIndex(this.target_.getAttribute("tileindex")),this.this_._clicked()},_clicked:function(){this._selector||(this._selector=new GSI.BaseLayerSelector(map,this.baseLayer,this.tiles,this.options),this._selector.on("click",L.bind(function(t){this.baseLayer.getActiveIndex()!=t.activeIndex&&this.baseLayer.setActiveIndex(t.activeIndex),this.onMapClick()},this)));var t=$(this._container).offset(),i=GSI.Utils.getScreenSize();$(this._container).fadeOut("fast"),this._selector.show(i.h-(t.top+$(this._container).outerHeight(!1)))}}),GSI.OnOffSwitch=L.Class.extend({includes:L.Mixin.Events,options:{className:"filetext",checked:!0},classNames:{onoff:"gsi_onoffswitch",filetext:"gsi_onoffswitch_file_text",visible:"gsi_onoffswitch_visible",visibleall:"gsi_onoffswitch_visible_all",usecocotile:"gsi_onoffswitch_usecocotile"},initialize:function(t){t=L.setOptions(this,t),this._create()},getElement:function(){return this.frame},getCheckBox:function(){return this.input},getId:function(){return this.id},_create:function(){var t="GSI_OnOffSwitch_"+GSI.Utils.getCurrentID();this.id=t,this.frame=$("<span>").addClass(this.classNames[this.options.className]),this.input=$("<input>").attr({type:"checkbox",id:t}).addClass("checkbox"),this.frame.append(this.input),this.options.checked&&this.input.attr({checked:!0});var i=$("<label>").addClass("label").attr({"for":t}),e=$("<span>").addClass("inner");i.append(e),e=$("<span>").addClass("switch"),i.append(e),this.frame.append(i),GSI.Utils.Browser.ie&&GSI.Utils.Browser.version<=8?(this._initCheckBoxIE8(),this.frame.click(L.bind(this.onFrameClick,this))):this.input.click(L.bind(function(){this.fire("change")},this))},_initCheckBoxIE8:function(){this.input.is(":checked")?(this.frame.find(".label,.inner").addClass("on_label_inner"),this.frame.find(".label,.switch").addClass("on_label_switch")):(this.frame.find(".label,.inner").removeClass("on_label_inner"),this.frame.find(".label,.switch").removeClass("on_label_switch"))},onFrameClick:function(){this.input.attr({checked:!this.input.is(":checked")}),this._initCheckBoxIE8(),this.fire("change")},checked:function(t){return 1==t?(this.input.attr({checked:!0}),this.input.prop({checked:!0})):0==t&&(this.input.attr({checked:!1}),this.input.prop({checked:!1})),GSI.Utils.Browser.ie&&GSI.Utils.Browser.version<=8&&this._initCheckBoxIE8(),this.input.is(":checked")}}),GSI.Control.AccessCounter=L.Control.extend({options:{position:"bottomright",url:"",refreshInterval:0},retryCounter:0,counter:null,initialize:function(t){L.setOptions(this,t)},onAdd:function(t){return this._map=t,this._container=L.DomUtil.create("div","gsi_control_accesscounter"),""!=this.options.url&&(this._update(),this._load()),$(this._container).attr({title:GSI.TEXT.ACCESSCOUNTER.TOOLTIP}).tooltip({position:{my:"right bottom",at:"right top",collision:"flipfit"},tooltipClass:"gsi_control_accesscounter_tooltip"}),this._container},onRemove:function(t){},_load:function(){if(""!=this.options.url)if(CONFIG.FORCECORS||GSI.Utils.isLocalUrl(this.options.url))this.ajax=$.ajax({type:"GET",dataType:"text",url:this.options.url,success:L.Util.bind(this._onLoad,this),error:L.Util.bind(this._onLoadError,this)});else{var t={url:this.options.url,lf:0};this.ajax=$.ajax({type:"GET",dataType:"jsonp",data:t,url:CONFIG.SERVERAPI.GETJSONP,success:L.Util.bind(this._onLoad,this),error:L.Util.bind(this._onLoadError,this)})}},_onLoad:function(t){try{var i=null;if(!t)return;i=t.data?t.data:t,this.counter=JSON.parse(i),this._container&&this._update(),this._next()}catch(e){this._onLoadError()}},_next:function(){this.options.refreshInterval>0&&(this._timerId&&(clearTimeout(this._timerId),this._timerId=null),this._timerId=setTimeout(L.bind(this._load,this),this.options.refreshInterval))},_retry:function(){this._timerId&&(clearTimeout(this._timerId),this._timerId=null),this.retryCounter++,this._load()},_onLoadError:function(){this._timerId&&(clearTimeout(this._timerId),this._timerId=null),this.retryCounter<CONFIG.ACCESSCOUNTERRETRY&&(this._timerId=setTimeout(L.bind(this._retry,this),1e4))},_update:function(){var t=new Date,i=new Date(t.getFullYear(),t.getMonth(),t.getDate()-1),e=("00"+(t.getMonth()+1)).slice(-2)+"/"+("00"+t.getDate()).slice(-2),s=("00"+(i.getMonth()+1)).slice(-2)+"/"+("00"+i.getDate()).slice(-2);this._map&&(this.counter?$(this._container).css({margin:0}).html(e+"&nbsp;"+this.counter.today+"、"+s+"&nbsp;"+this.counter.yesterday+"、総計&nbsp;"+(this.counter.total+"").replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")):$(this._container).css({margin:0}).html(e+"&nbsp;--、"+s+"&nbsp;--、総計&nbsp;------"))}}),GSI.Control.Spacer=L.Control.extend({options:{position:"bottomleft"},counter:null,initialize:function(t){L.setOptions(this,t)},setHeight:function(t){$(this._container).css({height:t+"px"})},onAdd:function(t){return this._map=t,this._container=L.DomUtil.create("div"),$(this._container).css({margin:0,padding:0,heght:0,width:0}),this._container},onRemove:function(t){}}),GSI.Control.Button=L.Control.extend({options:{position:"topleft",maxWidth:"300px"},initialize:function(t,i){this._button={},this.elem=t,this.options.position=i.position,this.setButton(i)},onAdd:function(t){this._map=t;var i=L.DomUtil.create("div","");return this._container=i,this._update(),this._container},onRemove:function(t){},setButton:function(t){var i={text:t.text,onClick:t.onClick,"class":t.className};this._button=i,this._update()},destroy:function(){this._button={},this._update()},_update:function(){this._map&&(this._container.innerHTML="",this._makeButton(this._button))},_makeButton:function(t){var i=this.elem;return this.elem.style.color="#4c493c",$(this._container).append(i),L.DomEvent.addListener(i,"click",L.DomEvent.stop),L.DomEvent.disableClickPropagation(i),i}}),GSI.Utils.encodeHTML=function(t){return t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;")},GSI.Utils.getInternetExplorerVersion=function(){var t=-1;if("Microsoft Internet Explorer"==navigator.appName){var i=navigator.userAgent,e=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=e.exec(i)&&(t=parseFloat(RegExp.$1))}else if("Netscape"==navigator.appName){var i=navigator.userAgent,e=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");null!=e.exec(i)&&(t=parseFloat(RegExp.$1))}return t},GSI.Utils.Browser={},GSI.Utils.Browser.userAgent=window.navigator.userAgent.toLowerCase(),"undefined"!=typeof document.documentElement.style.maxHeight){var ieVersion=GSI.Utils.getInternetExplorerVersion();1>ieVersion||(GSI.Utils.Browser.ie=!0,GSI.Utils.Browser.version=ieVersion)}else GSI.Utils.Browser.ie=!0,GSI.Utils.Browser.version=6;GSI.Utils.Browser.isiPhone=GSI.Utils.Browser.userAgent.indexOf("iphone")>=0,GSI.Utils.Browser.isiPod=GSI.Utils.Browser.userAgent.indexOf("ipod")>=0,GSI.Utils.Browser.isiPad=GSI.Utils.Browser.userAgent.indexOf("ipad")>=0,GSI.Utils.Browser.isiOS=GSI.Utils.Browser.isiPhone||GSI.Utils.Browser.isiPod||GSI.Utils.Browser.isiPad,GSI.Utils.Browser.isAndroid=GSI.Utils.Browser.userAgent.indexOf("android")>=0,GSI.Utils.Browser.isSmartMobile=GSI.Utils.Browser.isiOS||GSI.Utils.Browser.isAndroid,GSI.Utils.Browser.isChrome=-1!=GSI.Utils.Browser.userAgent.indexOf("chrome"),GSI.Utils.hasFileAPI=window.File&&window.FileReader&&window.FileList&&window.Blob,GSI.Utils.getCurrentID=function(){var t=1;return GSI.Utils._currentID||(GSI.Utils._currentID=1),t=GSI.Utils._currentID,GSI.Utils._currentID++,t},GSI.Utils.isLocalUrl=function(t){return GSI.ClientMode.baseUrl&&""!=GSI.ClientMode.baseUrl||t.match(/(http|https):\/\/.+/)?!1:!0},GSI.Utils.flashPlayerVersion=null,GSI.Utils.canUseFlashPlayer=function(){return null==GSI.Utils.flashPlayerVersion&&(GSI.Utils.flashPlayerVersion=GSI.Utils.getFlashPlayerVersion()),GSI.Utils.flashPlayerVersion>0},GSI.Utils.getFlashPlayerVersion=function(){var t=0;if(navigator.plugins&&navigator.mimeTypes["application/x-shockwave-flash"]){var i=navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin;i&&(t=parseInt(i.description.match(/\d+\.\d+/)))}else try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").match(/([0-9]+)/);e&&(t=parseInt(e[0]))}catch(s){}return 6>=t&&(t=0),t},GSI.Utils.getCurrentPath=function(){var t=GSI.ClientMode.location?GSI.ClientMode.location:location,i=(t.port,t.pathname);return(i.length<=0||"/"!=i.charAt(0))&&(i="/"+i),t.protocol+"//"+(t.host?t.host:t.hostname)+i},GSI.Utils.getTimeStampString=function(){var t=new Date,i=t.getFullYear(),e=t.getMonth()+1,s=t.getDate(),a=t.getHours(),n=t.getMinutes(),o=t.getSeconds(),r=t.getMilliseconds(),l=i+""+("00"+s).slice(-2)+("00"+e).slice(-2)+("00"+a).slice(-2)+("00"+n).slice(-2)+("00"+o).slice(-2)+r;return l},GSI.Utils.getScreenSize=function(){return{w:window.innerWidth?window.innerWidth:$(window).width(),h:window.innerHeight?window.innerHeight:$(window).height()}},GSI.Utils.world2Japan=function(t){var i=new Proj4js.Proj("EPSG:4326"),e=new Proj4js.Proj("EPSG:4301"),s=new Proj4js.Point(t.lng,t.lat),a=Proj4js.transform(i,e,s);return{x:a.x,y:a.y}},GSI.Utils.latLngToDMS=function(t){var t={lat:t.lat,lng:t.lng};t.lat<0?-1:1,t.lng<0?-1:1;t.lat=Math.abs(t.lat),t.lng=Math.abs(t.lng);var i=Math.floor(t.lat),e=Math.floor(60*(t.lat-i)),s=3600*(t.lat-i-e/60);60==s&&(s=0,e+=1),60==e&&(e=0,i+=1);var a=Math.floor(t.lng),n=Math.floor(60*(t.lng-a)),o=3600*(t.lng-a-n/60);return 60==o&&(o=0,n+=1),60==n&&(n=0,a+=1),{lat:{d:i,m:e,s:s},lng:{d:a,m:n,s:o}}},GSI.Utils.isVaridVariation=function(t){return!(t.lat<20||t.lat>46||t.lng<122||t.lng>154)},GSI.Utils.getVariation=function(t){var i=t.lng,e=t.lat;i=1e6*i,i=parseInt(i),i/=1e6,e=1e6*e,e=parseInt(e),e/=1e6;var s=i-138,a=e-37,n=7+40.585/60+19.003/60*a-6.265/60*s+15e-5*a*a+4e-4*a*s-.00985*s*s;return n},GSI.Utils.Cookie=L.Class.extend({_config:{defaults:{}},initialize:function(){},_encode:function(t){return this._config.raw?t:encodeURIComponent(t)},_decode:function(t){return this._config.raw?t:decodeURIComponent(t)},_stringifyCookieValue:function(t){return this._encode(this._config.json?JSON.stringify(t):String(t))},_parseCookieValue:function(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{var i=/\+/g;return t=decodeURIComponent(t.replace(i," ")),this._config.json?JSON.parse(t):t}catch(e){}},_read:function(t,i){return this._config.raw?t:this._parseCookieValue(t)},get:function(t){for(var i=t?void 0:{},e=document.cookie?document.cookie.split("; "):[],s=0,a=e.length;a>s;s++){var n=e[s].split("="),o=this._decode(n.shift()),r=n.join("=");if(t&&t===o){i=this._read(r);break}t||void 0===(r=this._read(r))||(i[o]=r)}return i},set:function(t,i,e){if(e=$.extend({},this._config.defaults,e),"number"==typeof e.expires){var s=e.expires,a=e.expires=new Date;a.setTime(+a+1e3*s*60*60)}return document.cookie=[this._encode(t),"=",this._stringifyCookieValue(i),e.expires?"; expires="+e.expires.toUTCString():"",e.path?"; path="+e.path:"",e.domain?"; domain="+e.domain:"",e.secure?"; secure":""].join("")},remove:function(t,i){return void 0===this.get(t)?!1:(this.set(t,"",$.extend({},i,{expires:-1})),!this.get(t))}});